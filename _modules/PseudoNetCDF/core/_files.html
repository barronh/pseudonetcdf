

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PseudoNetCDF.core._files &mdash; PseudoNetCDF 3.4.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=149be4c9"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            PseudoNetCDF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">PseudoNetCDF Userâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quick.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readers.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installing.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core.html">Core Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/PseudoNetCDF.html">PseudoNetCDF package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../issues.html">Get in touch</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PseudoNetCDF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">PseudoNetCDF.core._files</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for PseudoNetCDF.core._files</h1><div class="highlight"><pre>
<span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PseudoNetCDFFile&#39;</span><span class="p">,</span> <span class="s1">&#39;netcdf&#39;</span><span class="p">,</span> <span class="s1">&#39;PseudoNetCDFVariables&#39;</span><span class="p">]</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF._getreader</span><span class="w"> </span><span class="kn">import</span> <span class="n">registerreader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.netcdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">NetCDFFile</span><span class="p">,</span> <span class="n">NetCDFVariable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.pncwarn</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._dimensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">PseudoNetCDFDimension</span><span class="p">,</span> <span class="n">PseudoNetCDFDimensions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._variables</span><span class="w"> </span><span class="kn">import</span> <span class="n">PseudoNetCDFVariable</span><span class="p">,</span> <span class="n">PseudoNetCDFMaskedVariable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">class</span><span class="w"> </span><span class="nc">OrderedDefaultDict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;first argument must be callable or None&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OrderedDefaultDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">default</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PseudoNetCDFType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a PseudoNetCDFType meta-class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">):</span>
        <span class="n">pieces</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">longname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;core&#39;</span><span class="p">,)]</span> <span class="o">+</span>
            <span class="p">[</span><span class="n">pieces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;PseudoNetCDFFile&#39;</span><span class="p">,</span> <span class="s1">&#39;WrapPnc&#39;</span><span class="p">):</span>
                <span class="n">shortl</span> <span class="o">=</span> <span class="n">registerreader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
                <span class="n">longl</span> <span class="o">=</span> <span class="n">registerreader</span><span class="p">(</span><span class="n">longname</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">shortl</span> <span class="ow">or</span> <span class="n">longl</span><span class="p">):</span>
                    <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Not registered either as &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span>
                         <span class="s1">&#39; or &#39;</span> <span class="o">+</span> <span class="n">longname</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PseudoNetCDFType</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>


<span class="n">PseudoNetCDFSelfReg</span> <span class="o">=</span> <span class="n">PseudoNetCDFType</span><span class="p">(</span><span class="s1">&#39;pnc&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="vm">__doc__</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">))</span>


<div class="viewcode-block" id="PseudoNetCDFFile">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PseudoNetCDFFile</span><span class="p">(</span><span class="n">PseudoNetCDFSelfReg</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PseudoNetCDFFile provides an interface and standard set of</span>
<span class="sd">    methods that a file should present to act like a netCDF file</span>
<span class="sd">    using the Scientific.IO.NetCDF.NetCDFFile interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PseudoNetCDFFile.getMap">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.getMap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maptype</span><span class="o">=</span><span class="s1">&#39;basemap_auto&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maptype : string</span>
<span class="sd">            choices &#39;basemap&#39;, &#39;basemap_auto&#39;, &#39;cartopy&#39; (not yet)</span>
<span class="sd">            basemap : attempts to open a basemap with only supplied kwds</span>
<span class="sd">            basemap_auto : automatically adds llcrnrlon,llcrnrlat,u</span>
<span class="sd">                           rcrnrlon,urcrnrlat based on longitude_bounds</span>
<span class="sd">        **kwds : keywords</span>
<span class="sd">            for basemap or cartopy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map : basemap or cartopy axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">maptype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;basemap&#39;</span><span class="p">):</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">basemap_from_proj4</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">maptype</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_auto&#39;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="s1">&#39;longitude_bounds&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span>
                <span class="s1">&#39;latitude_bounds&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span>
            <span class="p">):</span>
                <span class="c1"># Get edges for bounding</span>
                <span class="n">lonb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude_bounds&#39;</span><span class="p">]</span>
                <span class="n">latb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude_bounds&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">lonb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">lonb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">lonb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">lonb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">lonb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">lonb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">lonb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">lonb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">lonb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">latb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">latb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">latb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">latb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">latb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">latb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">latb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">latb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">latb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">llcrnrlat</span><span class="p">,</span>
                             <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">urcrnrlon</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">urcrnrlat</span><span class="p">)</span>
                <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
            <span class="n">myproj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getproj</span><span class="p">(</span><span class="n">withgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">projformat</span><span class="o">=</span><span class="s1">&#39;proj4&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">basemap_from_proj4</span><span class="p">(</span><span class="n">myproj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">maptype</span> <span class="o">==</span> <span class="s1">&#39;cartopy&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cartopy is not yet implemented&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;maptype must be basemap, basemap_auto, or cartopy&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.getproj">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.getproj">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getproj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">withgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">projformat</span><span class="o">=</span><span class="s1">&#39;pyproj&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        withgrid : boolean</span>
<span class="sd">            use grid units instead of meters</span>
<span class="sd">        projformat : string</span>
<span class="sd">            &#39;pyproj&#39; (default), &#39;proj4&#39; or &#39;wkt&#39; allows function to</span>
<span class="sd">            return a pyproj projection object or a string in the</span>
<span class="sd">            format of proj4 or WKT</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        proj : string pyproj.Proj</span>
<span class="sd">             (wkt, proj4) or pyprojProj (pyproj)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">projformat</span> <span class="o">==</span> <span class="s1">&#39;pyproj&#39;</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">getproj</span>
            <span class="k">return</span> <span class="n">getproj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">withgrid</span><span class="o">=</span><span class="n">withgrid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">projformat</span> <span class="o">==</span> <span class="s1">&#39;proj4&#39;</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">getproj4</span>
            <span class="k">return</span> <span class="n">getproj4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">withgrid</span><span class="o">=</span><span class="n">withgrid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">projformat</span> <span class="o">==</span> <span class="s1">&#39;wkt&#39;</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">getprojwkt</span>
            <span class="k">return</span> <span class="n">getprojwkt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">withgrid</span><span class="o">=</span><span class="n">withgrid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;projformat must be pyproj, proj4 or wkt&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.ll2xy">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.ll2xy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ll2xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts lon/lat to x distances (no false easting/northing)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lon : scalar or iterable</span>
<span class="sd">            longitudes in decimal degrees</span>
<span class="sd">        lat : scalar or iterable</span>
<span class="sd">            latitudes in decimal degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : tuple of arrays</span>
<span class="sd">            coordinates in map projection (meters or radians)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getproj</span><span class="p">()(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getzdim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Heuristic function finds and returns the name of the vertical dimension</span>
<span class="sd">        based on common dimension names. Overwrite method for explicit control.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : {&#39;LAY&#39;, &#39;bottom_top&#39;, &#39;level&#39;, &#39;lev&#39;, &#39;layer&#39;, &#39;lay&#39;, &#39;z&#39;}</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; f = pnc.pncopen(&#39;&#39;, format=&#39;PseudoNetCDFFile&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;t&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;x&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;y&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;z&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f._getzdim()</span>
<span class="sd">        &#39;z&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="s1">&#39;LAY bottom_top level lev layer lay z&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Could not find z dimensions&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_gettdim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Heuristic function finds and returns the name of the time dimension</span>
<span class="sd">        based on common dimension names. Overwrite method for explicit control.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : {&#39;time&#39;, &#39;TSTEP&#39;, &#39;t&#39;, &#39;Time&#39;}</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; f = pnc.pncopen(&#39;&#39;, format=&#39;PseudoNetCDFFile&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;t&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;x&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;y&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;z&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f._gettdim()</span>
<span class="sd">        &#39;t&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="s1">&#39;time TSTEP t Time&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Could not find t dimensions&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getydim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Heuristic function finds and returns the name of the y or width</span>
<span class="sd">        dimension based on common dimension names. Overwrite method for</span>
<span class="sd">        explicit control.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : {&#39;latitude&#39;, &#39;lat&#39;, &#39;south_north&#39;, &#39;ROW&#39;, &#39;y&#39;}</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; f = pnc.pncopen(&#39;&#39;, format=&#39;PseudoNetCDFFile&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;t&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;x&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;y&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;z&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f._getydim()</span>
<span class="sd">        &#39;y&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="s1">&#39;latitude lat south_north ROW y&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Could not find y dimensions&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getxdim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Heuristic function finds and returns the name of the x or height</span>
<span class="sd">        dimension based on common dimension names. Overwrite method for</span>
<span class="sd">        explicit control.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : {&#39;longitude&#39;, &#39;lon&#39;, &#39;west_east&#39;, &#39;COL&#39;, &#39;x&#39;}</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; f = pnc.pncopen(&#39;&#39;, format=&#39;PseudoNetCDFFile&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;t&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;x&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;y&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f.createDimension(&#39;z&#39;, 4)</span>
<span class="sd">        &gt;&gt;&gt; f._getydim()</span>
<span class="sd">        &#39;y&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="s1">&#39;longitude long lon west_east COL x&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Could not find x dimensions&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PseudoNetCDFFile.ll2ij">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.ll2ij">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ll2ij</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts lon/lat to 0-based indicies (0,M), (0,N)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lon : scalar or iterable</span>
<span class="sd">            longitudes in decimal degrees</span>
<span class="sd">        lat : scalar or iterable</span>
<span class="sd">            latitudes in decimal degrees</span>
<span class="sd">        bounds : string</span>
<span class="sd">            ignore, error, warn if i,j are out of domain</span>
<span class="sd">        clean : string</span>
<span class="sd">            none - return values regardless of bounds;</span>
<span class="sd">            mask - mask values out of bounds;</span>
<span class="sd">            clip - return min(max(0, v), nx - 1)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        i, j : indices (0-based) for variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getproj</span><span class="p">(</span><span class="n">withgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_getxdim</span><span class="p">()])</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_getydim</span><span class="p">()])</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lowi</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">lowj</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">highi</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">nx</span><span class="p">)</span>
            <span class="n">highj</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="n">ny</span><span class="p">)</span>
            <span class="n">outb</span> <span class="o">=</span> <span class="p">(</span><span class="n">lowi</span> <span class="o">|</span> <span class="n">lowj</span> <span class="o">|</span> <span class="n">highi</span> <span class="o">|</span> <span class="n">highj</span><span class="p">)</span>
            <span class="n">nout</span> <span class="o">=</span> <span class="n">outb</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">nout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Points out of bounds; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">nout</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">outb</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clean</span> <span class="o">==</span> <span class="s1">&#39;clip&#39;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">clean</span> <span class="o">==</span> <span class="s1">&#39;mask&#39;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.xy2ll">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.xy2ll">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">xy2ll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts x, y to lon, lat (no false easting/northing)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : scalar or iterable</span>
<span class="sd">            projected west-east coordinates</span>
<span class="sd">        y : scalar or iterable</span>
<span class="sd">            projected south-north coordinates</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lon, lat : scalars or iterables</span>
<span class="sd">            longitudes and latitudes in decimal degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getproj</span><span class="p">()</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.ij2ll">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.ij2ll">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ij2ll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts i, j to lon, lat (no false easting/northing)</span>
<span class="sd">        using cell centers assuming 0-based i/j</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i : scalar/iterable</span>
<span class="sd">            indicies (0-based) for the west-east dimension</span>
<span class="sd">        j : scalar/iterable</span>
<span class="sd">            indicies (0-based) for the south-north dimension</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lon, lat : scalars or iterables</span>
<span class="sd">            longitudes and latitudes in decimal degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getproj</span><span class="p">(</span><span class="n">withgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.date2num">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.date2num">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">date2num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timekey</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : array-like</span>
<span class="sd">            array of datetime.datetime objects</span>
<span class="sd">        timekey : str</span>
<span class="sd">            time variable key which requires units and should have calendar.</span>
<span class="sd">            If calendar is missing, standard is the default. default &#39;time&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        num : array-like</span>
<span class="sd">            time in relative time as defined by units of time variable</span>
<span class="sd">            (i.e., timekey) which defaults to &#39;time&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="kn">import</span> <span class="n">date2num</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>
            <span class="n">utc</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">tzinfo</span>
            <span class="n">utc</span> <span class="o">=</span> <span class="n">tzinfo</span><span class="o">.</span><span class="n">utc</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="c1"># netCDF4 date2num is timezone naive; assumes UTC when not</span>
        <span class="c1"># specified and converts to UTC internally</span>
        <span class="c1"># so, if a tzinfo is involved, it should be removed</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[:]]):</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">t</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[:]</span>
            <span class="p">])</span>

        <span class="n">timeunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">timekey</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">timekey</span><span class="p">],</span> <span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;standard&#39;</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">timeunits</span><span class="p">,</span> <span class="n">calendar</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">num</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.time2idx">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.time2idx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">time2idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">timekey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert datetime objects to dimension indices</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : array-like</span>
<span class="sd">            array of datetime.datetime objects</span>
<span class="sd">        dim : str</span>
<span class="sd">            dimension name for val2idx</span>
<span class="sd">        timekey : str</span>
<span class="sd">            time variable key. None defaults to dim</span>
<span class="sd">        kwds : mappable</span>
<span class="sd">            see val2idx</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        idx : array-like</span>
<span class="sd">            time index (0-based)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timekey</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timekey</span> <span class="o">=</span> <span class="n">dim</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">nums</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">timekey</span><span class="o">=</span><span class="n">timekey</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val2idx</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">nums</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.time2t">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.time2t">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">time2t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : array of datetime.datetime objects</span>
<span class="sd">        interp : &#39;nearest&#39;, &#39;bounds&#39;, &#39;bounds_close&#39;</span>
<span class="sd">        index : return index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t : fractional time or if index, integers for indexing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;time2t is deprecated; transition to time2idx or date2num&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span>
        <span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ttype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;bounds&#39;</span><span class="p">,</span> <span class="s1">&#39;bounds_close&#39;</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an option; defaulting to nearest&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ttype</span><span class="p">))</span>
            <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span>
        <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
            <span class="n">mytimes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimes</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mytimes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimes</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mytimes</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># Find minimum resoultion</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s1">&#39;microsecond&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span>
        <span class="p">]:</span>
            <span class="n">minres</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">resvals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>
            <span class="n">myresvals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">mytimes</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">myresvals</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">resvals</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">break</span>

        <span class="c1"># Translate minimum resolution to numpy datetime</span>
        <span class="k">if</span> <span class="n">minres</span> <span class="o">==</span> <span class="s1">&#39;microsecond&#39;</span><span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="s1">&#39;datetime64[ns]&#39;</span>
        <span class="k">elif</span> <span class="n">minres</span> <span class="o">==</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="s1">&#39;datetime64[s]&#39;</span>
        <span class="k">elif</span> <span class="n">minres</span> <span class="o">==</span> <span class="s1">&#39;minute&#39;</span><span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="s1">&#39;datetime64[m]&#39;</span>
        <span class="k">elif</span> <span class="n">minres</span> <span class="o">==</span> <span class="s1">&#39;hour&#39;</span><span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="s1">&#39;datetime64[h]&#39;</span>
        <span class="k">elif</span> <span class="n">minres</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">):</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="s1">&#39;datetime64[D]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="s1">&#39;datetime64[ns]&#39;</span>

        <span class="c1"># Convert input time to numpy datetime at resolution</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">tu</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="c1"># Convert file&#39;s time to numpy datetime at resolution</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">mytimes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">tu</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>

        <span class="c1"># Use interpolation methods with no bounding for nearest</span>
        <span class="c1"># and bounds_close</span>
        <span class="k">if</span> <span class="n">ttype</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;bounds_close&#39;</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">imin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">imax</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">imin</span><span class="p">),</span> <span class="n">imax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="c1"># Use interpolation methods with bounding for nearest</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.val2idx">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.val2idx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">val2idx</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert coordinate values to indices</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dim : str</span>
<span class="sd">            name of dimensions, which must have a coordinate variable</span>
<span class="sd">        val : array-like</span>
<span class="sd">            value in coordinate space</span>
<span class="sd">        method : str</span>
<span class="sd">            nearest, bounds, exact - each calculates the index differently</span>
<span class="sd">             - nearest : uses interp with coord values and rounds</span>
<span class="sd">             - bounds : uses interp between bounding values and truncates</span>
<span class="sd">             - exact : returns indices for exact coord values with other</span>
<span class="sd">                       indices masked (clean keyword has no effect)</span>
<span class="sd">        bounds : str</span>
<span class="sd">            ignore, error, warn if i,j are out of domain</span>
<span class="sd">        left : scalar</span>
<span class="sd">            see np.interp</span>
<span class="sd">        right : scalar</span>
<span class="sd">            see np.interp</span>
<span class="sd">        clean : {&#39;none&#39;, &#39;mask&#39;}</span>
<span class="sd">            none - return values regardless of bounds;</span>
<span class="sd">            mask - mask invalid values (use with left/right=np.nan);</span>
<span class="sd">                   has no affect with method exact</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        i : array-like</span>
<span class="sd">            indices (0-based) for variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;exact&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;bounds&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">method</span> <span class="o">+</span> <span class="s1">&#39; method not implemented&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">bounds</span> <span class="o">+</span> <span class="s1">&#39; bounds not implemented&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clean</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;mask&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">clean</span> <span class="o">+</span> <span class="s1">&#39; clean not implemented&#39;</span><span class="p">)</span>

        <span class="n">dimv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
        <span class="n">dimvals</span> <span class="o">=</span> <span class="n">dimv</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dimvals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;val2idx is only implemented for 1-D coordinate variables&#39;</span>
            <span class="p">)</span>

        <span class="n">bounds_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="o">+</span> <span class="s1">&#39;_bounds&#39;</span><span class="p">,</span> <span class="n">dim</span> <span class="o">+</span> <span class="s1">&#39;_bnds&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dimv</span><span class="p">,</span> <span class="s1">&#39;bounds&#39;</span><span class="p">):</span>
            <span class="n">bounds_keys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimv</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

        <span class="n">dimevals</span> <span class="o">=</span> <span class="n">dimvals</span>
        <span class="k">for</span> <span class="n">dimbk</span> <span class="ow">in</span> <span class="n">bounds_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dimbk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">dimbv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dimbk</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dimbv</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dimevals</span> <span class="o">=</span> <span class="n">dimbv</span><span class="p">[:]</span>
            <span class="k">elif</span> <span class="n">dimbv</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">dimbv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">dimevals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dimbv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dimbv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;val2idx is only implemented for 1-D or 2-D bounds&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;; </span><span class="si">{}</span><span class="s1"> has </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dimbk</span><span class="p">,</span> <span class="n">dimbv</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bounds&#39;</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Approximating bounds for val2idx </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>
                <span class="n">dval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dimvals</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">dimvals</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">dimvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dval</span> <span class="o">==</span> <span class="n">dval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">start</span> <span class="o">-=</span> <span class="n">dval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">end</span> <span class="o">+=</span> <span class="n">dval</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">dimevals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
                    <span class="n">start</span><span class="p">,</span>
                    <span class="n">dimvals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">dval</span><span class="p">,</span>
                    <span class="n">end</span>
                <span class="p">])</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bounds&#39;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dimevals</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dimvals</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ddimevals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dimevals</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ddimevals</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">dimevals</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ddimevals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;coordinate is neither ascending nor descending&#39;</span><span class="p">)</span>

        <span class="c1"># import pdb; pdb.set_trace()</span>
        <span class="c1"># left = dimevals[0] - 1</span>
        <span class="c1"># right = dimevals[-1] + 1</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bounds&#39;</span><span class="p">:</span>
            <span class="n">fidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dimevals</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">right</span> <span class="o">==</span> <span class="n">dimevals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">fidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fidx</span><span class="p">,</span> <span class="n">dimvals</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dimvals</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;exact&#39;</span><span class="p">:</span>
            <span class="n">fidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dimvals</span><span class="p">),</span> <span class="n">fidx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clean</span> <span class="o">==</span> <span class="s1">&#39;mask&#39;</span><span class="p">:</span>
            <span class="n">outfidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">fidx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outfidx</span> <span class="o">=</span> <span class="n">fidx</span>

        <span class="k">if</span> <span class="n">bounds</span> <span class="o">!=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
            <span class="n">isleft</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">dimevals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">isright</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">dimevals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">isout</span> <span class="o">=</span> <span class="n">isleft</span> <span class="o">|</span> <span class="n">isright</span>
            <span class="k">if</span> <span class="n">isout</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">outmesg</span> <span class="o">=</span> <span class="s1">&#39;Values are out of bounds:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">isout</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">bounds</span> <span class="o">==</span> <span class="s1">&#39;warn&#39;</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span><span class="n">outmesg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">bounds</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">outmesg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
            <span class="n">outidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">outfidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outidx</span> <span class="o">=</span> <span class="n">outfidx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outidx</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.get_dest">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.get_dest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        path : str</span>
<span class="sd">            path where a new file is created on some action</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If None, a file is created in memory.</span>
<span class="sd">        Else, a netcdf file is created on disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_destination&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.set_dest">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.set_dest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the path where a new file is created on some action</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        path : str</span>
<span class="sd">            path for new file</span>
<span class="sd">        **options : keywords for constructor</span>
<span class="sd">            options for new file creation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_destination&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.get_varopt">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.get_varopt">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_varopt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get options</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        options : dictionary of options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_varopt&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.set_varopt">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.set_varopt">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_varopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set options to be used when creating any Variable</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        **options : options for createVariable</span>
<span class="sd">            optional keywords to be supplied when creating new variables in</span>
<span class="sd">            destination file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_varopt&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_newlike</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to return a file of the same class if a</span>
<span class="sd">        PseudoNetCDFFile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dest</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">netcdf</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dest</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PseudoNetCDFFile</span><span class="p">):</span>
            <span class="n">outt</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">outt</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">outt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">PseudoNetCDFFile</span><span class="p">()</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">set_varopt</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_varopt</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">outf</span>

<div class="viewcode-block" id="PseudoNetCDFFile.renameVariable">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.renameVariable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">renameVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copyall</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename variable (oldkey)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldkey : string</span>
<span class="sd">            variable to be renamed</span>
<span class="sd">        newkey : string</span>
<span class="sd">            new dame for variable</span>
<span class="sd">        inplace : boolean</span>
<span class="sd">            create the new variable in this netcdf file (default False)</span>
<span class="sd">        copyall : boolean</span>
<span class="sd">            if not inplace, should all variables be copied to new file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with renamed variable (this file if inplace = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renameVariables</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">oldkey</span><span class="p">:</span> <span class="n">newkey</span><span class="p">})</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.renameVariables">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.renameVariables">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">renameVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copyall</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">newkeys</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename variables for each oldkey: newkey dictionary item</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **newkeys : dictionary</span>
<span class="sd">            where key is the oldkey and value is the newkey</span>
<span class="sd">        inplace : boolean</span>
<span class="sd">            create the new variable in this netcdf file (default False)</span>
<span class="sd">        copyall :boolean</span>
<span class="sd">            if not inplace, should all variables be copied to new file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with renamed variable (this file if inplace = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span>
                <span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">copyall</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">copyall</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span> <span class="ow">in</span> <span class="n">newkeys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">oldkey</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">newkey</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">oldkey</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">oldkey</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.renameDimension">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.renameDimension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">renameDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename dimension (oldkey) in dimensions and in all variables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldkey : string</span>
<span class="sd">            dimension to be renamed</span>
<span class="sd">        newkey : string</span>
<span class="sd">            new dame for dimension</span>
<span class="sd">        inplace : boolean</span>
<span class="sd">            create the new variable in this netcdf file (default False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with renamed variable (this file if inplace = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renameDimensions</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">oldkey</span><span class="p">:</span> <span class="n">newkey</span><span class="p">})</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.renameDimensions">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.renameDimensions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">renameDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">newkeys</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename dimension (oldkey) in dimensions and in all variables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **newkeys : dictionary</span>
<span class="sd">            where key is the oldkey and value is the newkey</span>
<span class="sd">        inplace : boolean</span>
<span class="sd">            create the new variable in this netcdf file (default False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with renamed variable (this file if inplace = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span> <span class="ow">in</span> <span class="n">newkeys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">oldkey</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">olddims</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="n">newdims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">newkeys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">olddims</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">newdims</span> <span class="o">!=</span> <span class="n">olddims</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">newdims</span>
        <span class="k">for</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span> <span class="ow">in</span> <span class="n">newkeys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">oldkey</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.insertDimension">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.insertDimension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">insertDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multionly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">after</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">newdims</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert dimensions with keys and lengths from newdims</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **newdims : dictionary</span>
<span class="sd">            where key is the new dimension and value is the length</span>
<span class="sd">        newonly : boolean</span>
<span class="sd">            Only add dimension to variables that do not already have it,</span>
<span class="sd">            default True</span>
<span class="sd">        multionly : boolean</span>
<span class="sd">            Only add dimension if there are already more than one (good</span>
<span class="sd">            for ignoring coordinate dimensions)</span>
<span class="sd">        before : string</span>
<span class="sd">            if variable has this dimension, insert the new dimension before</span>
<span class="sd">            it. Otherwise, add to the beginning. (before takes precedence)</span>

<span class="sd">        after : string</span>
<span class="sd">            if variable has this dimension, insert the new dimension after it.</span>
<span class="sd">            Otherwise, add to the beginning.</span>

<span class="sd">        inplace : boolean</span>
<span class="sd">            create the new variable in this netcdf file (default False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance will new dimension in dimensions and variables</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        1. Adding a non unity dimension will cause the data to be repeated</span>
<span class="sd">           along the new axis.</span>
<span class="sd">        2. If order of addition matters, use multiple calls. newdimsuse</span>
<span class="sd">           will be a non-ordered dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">newdims</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">vdims</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">newonly</span> <span class="ow">and</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">vdims</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="n">multionly</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vdims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">ndims</span> <span class="o">=</span> <span class="p">[</span><span class="n">_dk</span> <span class="k">for</span> <span class="n">_dk</span> <span class="ow">in</span> <span class="n">vdims</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">before</span> <span class="ow">in</span> <span class="n">vdims</span><span class="p">:</span>
                    <span class="n">bi</span> <span class="o">=</span> <span class="n">vdims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">after</span> <span class="ow">in</span> <span class="n">vdims</span><span class="p">:</span>
                    <span class="n">bi</span> <span class="o">=</span> <span class="n">vdims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">after</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">before</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">after</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bi</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">ndims</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">bi</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span>
                    <span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">ndims</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">var</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">bi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.reorderDimensions">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.reorderDimensions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reorderDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldorder</span><span class="p">,</span> <span class="n">neworder</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate expr and return a PseudoNetCDFFile object with resutl</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        oldorder : iterable of strings</span>
<span class="sd">            dimension names in existing order</span>
<span class="sd">        neworder : iterable of strings</span>
<span class="sd">            dimension names in new order</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with dimensions reordered in variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">oldorder</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">oldorder</span><span class="p">)</span>
        <span class="n">neworder</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">neworder</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">varneworder</span> <span class="o">=</span> <span class="p">[</span><span class="n">dk</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">neworder</span> <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">dimensions</span><span class="p">]</span>
            <span class="n">varorder</span> <span class="o">=</span> <span class="p">[</span><span class="n">dk</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">dimensions</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varneworder</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">newvals</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">newdi</span><span class="p">,</span> <span class="n">newdk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">varneworder</span><span class="p">):</span>
                    <span class="n">axisidx</span> <span class="o">=</span> <span class="n">varorder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">newdk</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">axisidx</span> <span class="o">==</span> <span class="n">newdi</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">newvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">newvals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axisidx</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">newdi</span><span class="p">)</span>
                    <span class="n">varorder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">axisidx</span><span class="p">)</span>
                    <span class="n">varorder</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">newdi</span><span class="p">,</span> <span class="n">newdk</span><span class="p">)</span>
                <span class="k">assert</span> <span class="p">(</span><span class="n">varorder</span> <span class="o">==</span> <span class="n">varneworder</span><span class="p">)</span>
                <span class="n">newvals</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">varorder</span><span class="p">)</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">vk</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvals</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.eval">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.eval">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copyall</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate expr and return a PseudoNetCDFFile object with resutl</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr : string</span>
<span class="sd">            expression to evaluate</span>
<span class="sd">        inplace : boolean</span>
<span class="sd">            create the new variable in this netcdf file (default False)</span>
<span class="sd">        copyall : boolean</span>
<span class="sd">            if not inplace, should all variables be copied to new file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with renamed variable (this file if inplace = True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="c1"># Copy file to temporary PseudoNetCDF file</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">vardict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vardict</span><span class="p">:</span>
                <span class="n">vardict</span><span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="n">vardict</span><span class="p">[</span><span class="s1">&#39;np&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span>
        <span class="n">vardict</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">symtable</span><span class="w"> </span><span class="kn">import</span> <span class="n">symtable</span>
        <span class="n">symtbl</span> <span class="o">=</span> <span class="n">symtable</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s1">&#39;&lt;pncexpr&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">symtbl</span><span class="o">.</span><span class="n">get_symbols</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vardict</span><span class="p">:</span>
                <span class="n">tmpvar</span> <span class="o">=</span> <span class="n">vardict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tmpvar</span><span class="p">,</span> <span class="p">(</span><span class="n">PseudoNetCDFVariable</span><span class="p">,</span> <span class="n">NetCDFVariable</span><span class="p">)):</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">tmpvar</span> <span class="o">=</span> <span class="n">PseudoNetCDFVariable</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">())</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">copyall</span><span class="p">:</span>
                <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetVariables</span><span class="p">(</span><span class="n">newkeys</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">propd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tmpvar</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tmpvar</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">()])</span>
        <span class="n">propd</span><span class="p">[</span><span class="s1">&#39;expression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="n">dimt</span> <span class="o">=</span> <span class="n">tmpvar</span><span class="o">.</span><span class="n">dimensions</span>
        <span class="n">vardict</span><span class="p">[</span><span class="s1">&#39;outf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Assign expression to new variable.</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vardict</span><span class="p">)</span>
        <span class="n">assignedkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">is_assigned</span><span class="p">()]</span>
        <span class="n">assignedkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">assignedkeys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vardict</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">assignedkeys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">vardict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c1"># if the output variable has no dimensions,</span>
            <span class="c1"># there is likely a problem and the output</span>
            <span class="c1"># should be defined.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">PseudoNetCDFVariable</span><span class="p">,))</span> <span class="ow">and</span>
                <span class="n">val</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">!=</span> <span class="p">()</span>
            <span class="p">):</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span><span class="p">,</span>
                                    <span class="n">dimt</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">propd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.mask">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.mask">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">less</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">less_equal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">greater</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">greater_equal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">equal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">999</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply mask to all variables of same shape or just where dimensions</span>
<span class="sd">        match.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        where : array-like</span>
<span class="sd">            boolean array to use as a mask see numpy.ma.masked_where</span>
<span class="sd">        greater : scalar</span>
<span class="sd">            mask when values are greater than this value see</span>
<span class="sd">            numpy.ma.masked_greater</span>
<span class="sd">        less : scalar</span>
<span class="sd">            mask when values are less than this value see</span>
<span class="sd">            numpy.ma.masked_less</span>
<span class="sd">        greater_equal : scalar</span>
<span class="sd">            mask when values are greater than or equal to this value see</span>
<span class="sd">            numpy.ma.masked_greater</span>
<span class="sd">        less_equal : scalar</span>
<span class="sd">            mask when values are less than or equal to this value see</span>
<span class="sd">            numpy.ma.masked_less</span>
<span class="sd">        values : scalar</span>
<span class="sd">            mask when values are equal to this value within standard floating</span>
<span class="sd">            point see numpy.ma.masked_values</span>
<span class="sd">        equal : scalar</span>
<span class="sd">            mask when values are exactly this value (i.e., integers) see</span>
<span class="sd">            numpy.ma.masked_equal</span>
<span class="sd">        invalid : boolean</span>
<span class="sd">            mask when values are invalid, see numpy.ma.masked_invalid</span>
<span class="sd">        mask : array-like</span>
<span class="sd">            alias for where</span>
<span class="sd">        dims : iterable of strings</span>
<span class="sd">            only apply &quot;mask&quot; or &quot;where&quot; to variables with these dimensions</span>
<span class="sd">            no effet on other masks</span>
<span class="sd">        fill_value : scalar</span>
<span class="sd">            value to use as the fill_value for new arrays</span>
<span class="sd">        coords : boolean</span>
<span class="sd">            if True, apply masks to coordinate variables. Default, False</span>
<span class="sd">        verbose : int</span>
<span class="sd">            level of verbosity for function, mostly for debugging</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with masked variables</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.ma : all masks are passing throught to numpy.ma.masked_...</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        mask options are not mutually exclusive. the order is where, greater,</span>
<span class="sd">        greater_equal, less, less_equal, values, equal, invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="k">elif</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;mask is an alias to where; supply one or the other, &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;but not both&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">dims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maskdims</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maskdims</span> <span class="o">=</span> <span class="n">dims</span>

        <span class="n">coordkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="n">nitems</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">newvar</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span>
                <span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">vk</span> <span class="ow">in</span> <span class="n">coordkeys</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
                <span class="n">newvar</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
                <span class="k">continue</span>

            <span class="n">vals</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">maskdims</span> <span class="o">==</span> <span class="n">vv</span><span class="o">.</span><span class="n">dimensions</span> <span class="ow">or</span>
                    <span class="p">(</span>
                        <span class="n">maskdims</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                        <span class="n">where</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
                    <span class="c1"># np.ma.putmask(newvar[...], mask==False, vv[...])</span>
                    <span class="c1"># vals = newvar[...]</span>
                <span class="c1"># else:</span>
                <span class="c1">#     vals = vv[...]</span>

            <span class="k">if</span> <span class="n">greater</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">greater</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">greater_equal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_greater_equal</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">greater_equal</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">less</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">less</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">less_equal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">less_equal</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">equal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">equal</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">newvar</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.plot">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varkey</span><span class="p">,</span> <span class="n">plottype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">plot_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbar_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">map_kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimreduction</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varkey : string</span>
<span class="sd">            the variable to plot</span>
<span class="sd">        plottype : string</span>
<span class="sd">            any dimension name pair delimited by a hyphen (e.g.,</span>
<span class="sd">            longitude-latitude, latitude-pressure, longitude-pressure,</span>
<span class="sd">            vertical-profile, time-longitude, time-latitude, time-pressure)</span>
<span class="sd">            defaults to the last two dimensions.</span>
<span class="sd">        ax_kw : dictionary</span>
<span class="sd">            keywords for the axes to be created</span>
<span class="sd">        plot_kw : dictionary</span>
<span class="sd">            keywords for the plot (plot, scatter, or pcolormesh) to be</span>
<span class="sd">            created</span>
<span class="sd">        cbar_kw : dictionary or bool or None</span>
<span class="sd">            keywords for the colorbar; if True or None, use defaults.</span>
<span class="sd">            If False, do not create a colorbar</span>
<span class="sd">        map_kw : dictionary or bool or None</span>
<span class="sd">            keywords for the getMap routine, which is only used with</span>
<span class="sd">            map capable dimensions (ie, plottype=&#39;longitude-latitude&#39;)</span>
<span class="sd">            If True or None, use default configuration dict(countries=True,</span>
<span class="sd">            coastlines=True, states=False, counties=False). If False,</span>
<span class="sd">            do not draw a map.</span>
<span class="sd">        dimreduction : string or function</span>
<span class="sd">            dimensions not being used in the plot are removed using</span>
<span class="sd">            applyAlongDimensions(dimkey=dimreduction) where each dimenions</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : matplotlib.axes.Axes</span>
<span class="sd">            Axes that was drawn on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">..coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">getbounds</span>

        <span class="k">if</span> <span class="n">ax_kw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax_kw</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">plot_kw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kw</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">cbar_kw</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cbar_kw</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">cbar_kw</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">map_kw</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">map_kw</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">map_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="n">map_kw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">map_kw</span> <span class="o">=</span> <span class="n">map_kw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">apply2dim</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varkey</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plottype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vdims</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vdims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plottype</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plottype</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-profile&#39;</span>

        <span class="n">varunit</span> <span class="o">=</span> <span class="n">varkey</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">):</span>
            <span class="n">varunit</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">dimlens</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">dk</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">])</span>
        <span class="n">dimpos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">dk</span><span class="p">,</span> <span class="n">di</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span><span class="p">,</span> <span class="n">dk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)])</span>
        <span class="n">xkey</span><span class="p">,</span> <span class="n">ykey</span> <span class="o">=</span> <span class="n">plottype</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ykey</span> <span class="o">==</span> <span class="s1">&#39;profile&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dimkey</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dimlens</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dimkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xkey</span><span class="p">,</span> <span class="n">ykey</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dimlens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dimkey</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">apply2dim</span><span class="p">[</span><span class="n">dimkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">dimreduction</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">apply2dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">subsetkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">varkey</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">xkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">subsetkeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ykey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">subsetkeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ykey</span><span class="p">)</span>
            <span class="n">myf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetVariables</span><span class="p">(</span><span class="n">subsetkeys</span><span class="p">)</span>\
                      <span class="o">.</span><span class="n">applyAlongDimensions</span><span class="p">(</span><span class="o">**</span><span class="n">apply2dim</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">myf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varkey</span><span class="p">]</span>
            <span class="n">dimlens</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">dk</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]))</span>
                            <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myf</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">ykey</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,):</span>
            <span class="n">vaxi</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>
            <span class="n">vsize</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">vaxi</span><span class="p">]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">var</span><span class="p">[:],</span> <span class="n">vaxi</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vsize</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">xkey</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">myf</span><span class="o">.</span><span class="n">getTimes</span><span class="p">()</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xm</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">xm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">getbounds</span><span class="p">(</span><span class="n">myf</span><span class="p">,</span> <span class="n">xkey</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="o">**</span><span class="n">ax_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ykey</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">getbounds</span><span class="p">(</span><span class="n">myf</span><span class="p">,</span> <span class="n">xkey</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">varkey</span> <span class="o">+</span> <span class="s1">&#39;(min, max)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">varkey</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kw</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">varunit</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ax</span>

        <span class="k">if</span> <span class="n">ykey</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">ym</span> <span class="o">=</span> <span class="n">myf</span><span class="o">.</span><span class="n">getTimes</span><span class="p">()</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ym</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">ym</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">getbounds</span><span class="p">(</span><span class="n">myf</span><span class="p">,</span> <span class="n">ykey</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dimpos</span><span class="p">[</span><span class="n">xkey</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dimpos</span><span class="p">[</span><span class="n">ykey</span><span class="p">]:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">T</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cbar_kw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">cbar_kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">varunit</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xkey</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">AutoDateFormatter</span><span class="p">(</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">ykey</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">AutoDateFormatter</span><span class="p">(</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">mappabledims</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">plottype</span> <span class="o">==</span> <span class="s1">&#39;longitude-latitude&#39;</span> <span class="ow">or</span>
            <span class="n">plottype</span> <span class="o">==</span> <span class="s1">&#39;lon-lat&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">mappabledims</span> <span class="ow">and</span> <span class="n">map_kw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">map_kw</span> <span class="o">=</span> <span class="n">map_kw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">coastlines</span> <span class="o">=</span> <span class="n">map_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coastlines&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">countries</span> <span class="o">=</span> <span class="n">map_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;countries&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">states</span> <span class="o">=</span> <span class="n">map_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;states&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">counties</span> <span class="o">=</span> <span class="n">map_kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;counties&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">bmap</span> <span class="o">=</span> <span class="n">myf</span><span class="o">.</span><span class="n">getMap</span><span class="p">(</span><span class="o">**</span><span class="n">map_kw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">coastlines</span><span class="p">:</span>
                    <span class="n">bmap</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">countries</span><span class="p">:</span>
                    <span class="n">bmap</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">states</span><span class="p">:</span>
                    <span class="n">bmap</span><span class="o">.</span><span class="n">drawstates</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">counties</span><span class="p">:</span>
                    <span class="n">bmap</span><span class="o">.</span><span class="n">drawcounties</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ykey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.setncatts">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.setncatts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setncatts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attdict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set ncattrs from attdict keys and values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attdict : dictionary</span>
<span class="sd">            key/value pairs of properties</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">attdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.getncatts">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.getncatts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getncatts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all ncattrs keys and values as a dictionary</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        attdict : dictionary</span>
<span class="sd">            key/value pairs of properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outd</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="n">outd</span><span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outd</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.from_arrays">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.from_arrays">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_arrays</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nameattr</span><span class="o">=</span><span class="s1">&#39;standard_name&#39;</span><span class="p">,</span>
        <span class="n">fileattrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">inarrkw</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new ioapi file from arrays.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        dims : iterable</span>
<span class="sd">            Explicit dimensions. If not provided, they will be created as</span>
<span class="sd">            phony_dim_{i} where i for i in range(ndim). For example, an array</span>
<span class="sd">            of shape (2, 3) would have dimensions (phony_dim_0, phony_dim_1)</span>
<span class="sd">        attrs : mappable</span>
<span class="sd">            Attributes for all variables (e.g., units). long_name and</span>
<span class="sd">            var_desc will be set based on key if not provided.</span>
<span class="sd">        nameattr : str</span>
<span class="sd">            Key for name as an attribute</span>
<span class="sd">        fileattrs : mappable</span>
<span class="sd">            Attributes for the file to be created.</span>
<span class="sd">        inarrkw : mappable</span>
<span class="sd">            Keys are the names of variables to be created and the value should</span>
<span class="sd">            be an array of values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetcdf-like file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

        <span class="n">invarkw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">inarrkw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">myattrs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">myattrs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">nameattr</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mydims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;phony_dim_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">ndim</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mydims</span> <span class="o">=</span> <span class="n">dims</span>
            <span class="n">invarkw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">PseudoNetCDFVariable</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">mydims</span><span class="p">,</span> <span class="o">**</span><span class="n">myattrs</span>
            <span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_ncvs</span><span class="p">(</span><span class="o">**</span><span class="n">invarkw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileattrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">setncatts</span><span class="p">(</span><span class="n">fileattrs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.from_ncvs">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.from_ncvs">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_ncvs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">invars</span><span class="p">,</span> <span class="o">**</span><span class="n">invarkw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        invars : list</span>
<span class="sd">            NetCDF-like variable must have standard_name, long_name or name</span>

<span class="sd">        invarkw : kwds</span>
<span class="sd">            NetCDF-like variables</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetcdf-like file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">invar</span> <span class="ow">in</span> <span class="n">invars</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">invar</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">invar</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span><span class="n">ds</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outf</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">invar</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">inkey</span><span class="p">,</span> <span class="n">invar</span> <span class="ow">in</span> <span class="n">invarkw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">invar</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">invar</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span><span class="n">ds</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">outf</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outf</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">invar</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">inkey</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.from_ncf">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.from_ncf">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_ncf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        infile : PseudoNetCDF-like file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetcdf-like file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">dv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outf</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_copywith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function for making copies of the same type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        props : boolean</span>
<span class="sd">            include properties (default: True)</span>
<span class="sd">        dimensions : boolean</span>
<span class="sd">            include dimensions (default: True)</span>
<span class="sd">        variables : boolean</span>
<span class="sd">            include variable structures (default: False)</span>
<span class="sd">        data : boolean</span>
<span class="sd">            include variable data (default: False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with some parts</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Internal function does not return variables by default.</span>
<span class="sd">        This is useful for functions like slice, apply, eval, etc.</span>

<span class="sd">        The _ in _copywith means this is a private function and the</span>
<span class="sd">        call interface may change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_newlike</span><span class="p">()</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">_operator_exclude_vars</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">props</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dimensions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">dv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">variables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outf</span>

<div class="viewcode-block" id="PseudoNetCDFFile.copy">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for making copies of the same type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        props : boolean</span>
<span class="sd">            include properties (default: True)</span>
<span class="sd">        dimensions : boolean</span>
<span class="sd">            include dimensions (default: True)</span>
<span class="sd">        variables : boolean</span>
<span class="sd">            include variable structures (default: True)</span>
<span class="sd">        data : boolean</span>
<span class="sd">            include variable data (default: True)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span>
                              <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.interpDimension">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.interpDimension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">interpDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimkey</span><span class="p">,</span> <span class="n">newdimvals</span><span class="p">,</span> <span class="n">coordkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">interpkwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimkey : string</span>
<span class="sd">            the new dimension for interpolation</span>
<span class="sd">        newdimvals : iterable</span>
<span class="sd">            the new values to interpolate to</span>
<span class="sd">        coordkey : string</span>
<span class="sd">            the variable to use as the old coordinate values</span>
<span class="sd">        interptype : string</span>
<span class="sd">            &#39;linear&#39; or &#39;conserve&#39;. linear uses a linear interpolation</span>
<span class="sd">             conserve uses a mass conserving interpolation</span>
<span class="sd">        extrapolate : boolean</span>
<span class="sd">            allow extrapolation beyond bounds with linear, default False</span>
<span class="sd">        fill_value : numeric value</span>
<span class="sd">            set fill value (e.g, nan) to prevent extrapolation or edge</span>
<span class="sd">            continuation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with all variables interpolated</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        When extrapolate is false, the edge values are used for points beyond</span>
<span class="sd">        the inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">..coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">getinterpweights</span>

        <span class="k">if</span> <span class="n">coordkey</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">olddimvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dimkey</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">olddimvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">coordkey</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">olddimvals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">newdimvals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">getinterpweights</span><span class="p">(</span><span class="n">olddimvals</span><span class="p">,</span> <span class="n">newdimvals</span><span class="p">,</span> <span class="o">**</span><span class="n">interpkwds</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">interpd</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">newdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">data</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span>
                               <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">newdata</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applyAlongDimensions</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">dimkey</span><span class="p">:</span> <span class="n">interpd</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">olddim</span> <span class="o">=</span> <span class="n">olddimvals</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="n">newdim</span> <span class="o">=</span> <span class="n">newdimvals</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="k">if</span> <span class="n">olddim</span> <span class="o">!=</span> <span class="n">newdim</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can only interpolate if coordinate &#39;</span> <span class="o">+</span>
                                 <span class="s1">&#39;variable have the same named dimensions&#39;</span><span class="p">)</span>
            <span class="n">dimaxis</span> <span class="o">=</span> <span class="n">olddim</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dimkey</span><span class="p">)</span>
            <span class="n">ndl</span> <span class="o">=</span> <span class="n">newdimvals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dimaxis</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">dk</span> <span class="o">==</span> <span class="n">dimkey</span><span class="p">:</span>
                    <span class="n">dl</span> <span class="o">=</span> <span class="n">ndl</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">dv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">,</span> <span class="n">dimlen</span><span class="o">=</span><span class="n">dl</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">nvv</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span>
                    <span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="n">vv</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">!=</span> <span class="n">newdim</span><span class="p">)</span>

            <span class="n">Ni</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">=</span> <span class="n">olddimvals</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="n">dimaxis</span><span class="p">],</span> <span class="n">olddimvals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dimaxis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">s_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">Ni</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
                    <span class="n">od</span> <span class="o">=</span> <span class="n">olddimvals</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="n">s_</span><span class="p">[:,</span> <span class="p">]</span> <span class="o">+</span> <span class="n">kk</span><span class="p">]</span>
                    <span class="n">nd</span> <span class="o">=</span> <span class="n">newdimvals</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="n">s_</span><span class="p">[:,</span> <span class="p">]</span> <span class="o">+</span> <span class="n">kk</span><span class="p">]</span>
                    <span class="n">weights</span> <span class="o">=</span> <span class="n">getinterpweights</span><span class="p">(</span><span class="n">od</span><span class="p">,</span> <span class="n">nd</span><span class="p">,</span> <span class="o">**</span><span class="n">interpkwds</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">nvk</span><span class="p">,</span> <span class="n">nvv</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">nvv</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">!=</span> <span class="n">newdim</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">vv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">nvk</span><span class="p">]</span>
                        <span class="n">interpedv</span> <span class="o">=</span> <span class="p">(</span><span class="n">weights</span> <span class="o">*</span>
                                     <span class="n">vv</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="n">s_</span><span class="p">[:,</span> <span class="p">]</span> <span class="o">+</span> <span class="n">kk</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">nvv</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="n">s_</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpedv</span>
        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.applyAlongDimensions">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.applyAlongDimensions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">applyAlongDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">dimfuncs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to numpy.apply_along_axis, but for damed dimensions and</span>
<span class="sd">        processes dimensions as well as variables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimfuncs : dictionary</span>
<span class="sd">            key value pairs where the key is a dimensions and the value is a</span>
<span class="sd">            1D function (func1d) or a dictionary. If the value is a dictionary</span>
<span class="sd">            it must include func1d as a function and any keyword arguments as</span>
<span class="sd">            additional options</span>
<span class="sd">        verbose : integer</span>
<span class="sd">            0 silent, 1 show variable, 2 show dimensions and variables</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with variables and dimensions after processing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dimlens</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dimlens</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dimfuncs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">dimfuncs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="n">dvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">dvar</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">newdl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dvar</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="n">df</span><span class="p">)(</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newdl</span> <span class="o">=</span> <span class="n">df</span><span class="p">(</span><span class="n">dvar</span><span class="p">[:])</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
            <span class="n">dimlens</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="n">newdl</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">newdl</span> <span class="o">=</span> <span class="n">dimlens</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">dv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">,</span> <span class="n">dimlen</span><span class="o">=</span><span class="n">newdl</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vark</span><span class="p">,</span> <span class="n">varo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">vdims</span> <span class="o">=</span> <span class="n">varo</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="n">newvals</span> <span class="o">=</span> <span class="n">varo</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
            <span class="n">dik</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">vdims</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">di</span><span class="p">,</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">dik</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">dimfuncs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">vark</span><span class="p">,</span> <span class="n">dk</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">di</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">newvals</span><span class="p">)</span>
                    <span class="n">dfunc</span> <span class="o">=</span> <span class="n">dimfuncs</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dfunc</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dfunc</span><span class="p">)</span>
                        <span class="n">noopts</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;func1d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfunc</span>
                        <span class="n">noopts</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">noopts</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dfunc</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">newvals</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">newvals</span><span class="p">,</span> <span class="n">dfunc</span><span class="p">)(</span>
                            <span class="n">axis</span><span class="o">=</span><span class="n">di</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">newvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">dfunc</span><span class="p">,</span> <span class="n">di</span><span class="p">,</span> <span class="n">newvals</span><span class="p">)</span>
            <span class="n">newvaro</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">varo</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vark</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">newvaro</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvals</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.getTimes">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.getTimes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getTimes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetype</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an array of datetime objects</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datetype : string or numpy.dtype</span>
<span class="sd">            &#39;datetime&#39; or datetime64 dtype</span>
<span class="sd">        bounds : boolean</span>
<span class="sd">            get time boundaries</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : array</span>
<span class="sd">            datetime objects or array of numpy&#39;s datetype type</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        self must have a time or TFLAG variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.coordutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">_parse_ref_date</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>
        <span class="n">utc</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>

        <span class="n">_calendaryearlike</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;noleap&#39;</span><span class="p">:</span> <span class="mi">1970</span><span class="p">,</span> <span class="s1">&#39;365_day&#39;</span><span class="p">:</span> <span class="mi">1970</span><span class="p">,</span>
                             <span class="s1">&#39;all_leap&#39;</span><span class="p">:</span> <span class="mi">1972</span><span class="p">,</span> <span class="s1">&#39;366_day&#39;</span><span class="p">:</span> <span class="mi">1972</span><span class="p">}</span>

        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
            <span class="n">timeunits</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="s1">&#39;gregorian&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bounds</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;time_bounds&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time_bounds&#39;</span><span class="p">]</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">dts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dts</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Time bounds are approximate&#39;</span><span class="p">)</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;since&#39;</span> <span class="ow">in</span> <span class="n">timeunits</span><span class="p">:</span>
                <span class="n">unit</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">timeunits</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; since &#39;</span><span class="p">)</span>
                <span class="c1"># Get the reference date</span>
                <span class="n">refdate</span> <span class="o">=</span> <span class="n">_parse_ref_date</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">calendar</span> <span class="ow">in</span> <span class="n">_calendaryearlike</span><span class="p">:</span>
                    <span class="n">refyear</span> <span class="o">=</span> <span class="n">refdate</span><span class="o">.</span><span class="n">year</span>
                    <span class="c1"># Get a year for relative day calculations</span>
                    <span class="n">yearlike</span> <span class="o">=</span> <span class="n">_calendaryearlike</span><span class="p">[</span><span class="n">calendar</span><span class="p">]</span>
                    <span class="c1"># In that year, how many seconds and days are there</span>
                    <span class="n">yearseconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="n">yearlike</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
                                   <span class="n">date</span><span class="p">(</span><span class="n">yearlike</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="n">yeardays</span> <span class="o">=</span> <span class="n">yearseconds</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">/</span> <span class="mi">24</span>

                    <span class="c1"># Get a new reference date in yearlike</span>
                    <span class="n">crefdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">yearlike</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">refdate</span><span class="o">.</span><span class="n">month</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">refdate</span><span class="o">.</span><span class="n">day</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Get start date in yearlike</span>
                        <span class="n">refcdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span>
                            <span class="n">yearlike</span><span class="p">,</span> <span class="n">refdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">refdate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>
                        <span class="c1"># Calculate delta in years</span>
                        <span class="n">addyears</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">crefdate</span> <span class="o">-</span> <span class="n">refcdate</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">yearseconds</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">addyears</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="c1"># Convert time to fractional years, including change in</span>
                    <span class="c1"># reference</span>
                    <span class="n">incrdenom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;years&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">:</span> <span class="n">yeardays</span><span class="p">,</span>
                                 <span class="s1">&#39;hours&#39;</span><span class="p">:</span> <span class="n">yeardays</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>
                                 <span class="s1">&#39;minutes&#39;</span><span class="p">:</span> <span class="n">yeardays</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
                                 <span class="s1">&#39;seconds&#39;</span><span class="p">:</span> <span class="n">yeardays</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">}[</span><span class="n">unit</span><span class="p">]</span>
                    <span class="n">fracyearincrs</span> <span class="o">=</span> <span class="n">time</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">incrdenom</span> <span class="o">+</span> <span class="n">addyears</span>
                    <span class="c1"># Split into years and days</span>
                    <span class="n">yearincrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fracyearincrs</span> <span class="o">//</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
                    <span class="n">dayincrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">fracyearincrs</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">yeardays</span>
                    <span class="c1"># Add days to the calendar year reference</span>
                    <span class="n">cdays</span> <span class="o">=</span> <span class="p">[</span><span class="n">crefdate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">dayinc</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">dayinc</span> <span class="ow">in</span> <span class="n">dayincrs</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Combine calendar specific month and day with new year</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                            <span class="n">datetime</span><span class="p">(</span><span class="n">refyear</span> <span class="o">+</span> <span class="n">yearinc</span><span class="p">,</span> <span class="n">cday</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                     <span class="n">cday</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">yearinc</span><span class="p">,</span> <span class="n">cday</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yearincrs</span><span class="p">,</span> <span class="n">cdays</span><span class="p">)])</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">warn</span><span class="p">((</span><span class="s1">&#39;Years calculated from </span><span class="si">%d</span><span class="s1"> day year, but &#39;</span> <span class="o">+</span>
                              <span class="s1">&#39;month/days calculated for actual year. &#39;</span> <span class="o">+</span>
                              <span class="s1">&#39;Usually means data has Feb 29th in a non &#39;</span> <span class="o">+</span>
                              <span class="s1">&#39;leap year&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">yeardays</span><span class="p">)</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                            <span class="n">datetime</span><span class="p">(</span><span class="n">refyear</span> <span class="o">+</span> <span class="n">yearinc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dayinc</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">yearinc</span><span class="p">,</span> <span class="n">dayinc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yearincrs</span><span class="p">,</span> <span class="n">dayincrs</span><span class="p">)])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">refdate</span> <span class="o">+</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timedelta</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">unit</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)})</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time</span><span class="p">[:]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">time</span>
        <span class="k">elif</span> <span class="s1">&#39;TFLAG&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;TFLAG&#39;</span><span class="p">][:][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dates</span> <span class="o">==</span> <span class="o">-</span><span class="mi">635</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Dates of -635 set to 1970001&#39;</span><span class="p">)</span>
                <span class="n">dates</span><span class="p">[</span><span class="n">dates</span> <span class="o">==</span> <span class="o">-</span><span class="mi">635</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1970001</span>
            <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;TFLAG&#39;</span><span class="p">][:][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">yyyys</span> <span class="o">=</span> <span class="p">(</span><span class="n">dates</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
            <span class="n">jjj</span> <span class="o">=</span> <span class="n">dates</span> <span class="o">%</span> <span class="mi">1000</span>
            <span class="n">hours</span> <span class="o">=</span> <span class="n">times</span> <span class="o">//</span> <span class="mi">10000</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="n">times</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">//</span> <span class="mi">100</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="n">times</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="n">days</span> <span class="o">=</span> <span class="n">jjj</span> <span class="o">+</span> <span class="p">(</span><span class="n">hours</span> <span class="o">+</span> <span class="n">minutes</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">+</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">24.</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datetime</span><span class="p">(</span><span class="n">yyyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">yyyy</span><span class="p">,</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yyyys</span><span class="p">,</span> <span class="n">days</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">bounds</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;TSTEP&#39;</span><span class="p">):</span>
                    <span class="n">tstep</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;TSTEP&#39;</span><span class="p">)</span>
                    <span class="n">sh</span> <span class="o">=</span> <span class="n">tstep</span> <span class="o">//</span> <span class="mi">10000</span> <span class="o">*</span> <span class="mi">3600</span>
                    <span class="n">sm</span> <span class="o">=</span> <span class="n">tstep</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">60</span>
                    <span class="n">ss</span> <span class="o">=</span> <span class="n">tstep</span> <span class="o">%</span> <span class="mi">100</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">sh</span> <span class="o">+</span> <span class="n">sm</span> <span class="o">+</span> <span class="n">ss</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">dts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">dt</span> <span class="o">!=</span> <span class="n">dts</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Time bounds are approximate&#39;</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;SDATE&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;STIME&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;TSTEP&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;TSTEP&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">jdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SDATE</span>
            <span class="k">if</span> <span class="n">jdate</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SDATE was </span><span class="si">{</span><span class="n">jdate</span><span class="si">}</span><span class="s1">; using 1970001&#39;</span><span class="p">)</span>
                <span class="n">jdate</span> <span class="o">=</span> <span class="mi">1970001</span>
            <span class="n">hhmmss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIME</span>
            <span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%07d</span><span class="s1"> </span><span class="si">%06d</span><span class="s1">+0000&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jdate</span><span class="p">,</span> <span class="n">hhmmss</span><span class="p">),</span> <span class="s1">&#39;%Y%j %H%M%S%z&#39;</span><span class="p">)</span>
            <span class="n">tstepstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%06d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">TSTEP</span>
            <span class="n">timeincr</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tstepstr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span> <span class="o">+</span> \
                <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tstepstr</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span> <span class="o">+</span> \
                <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tstepstr</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">ntimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;TSTEP&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">bounds</span><span class="p">:</span>
                <span class="n">ntimes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">timeincrs</span> <span class="o">=</span> <span class="n">timeincr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ntimes</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">refdate</span> <span class="o">+</span> <span class="n">timeincrs</span>
        <span class="k">elif</span> <span class="s1">&#39;tau0&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1985</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tau0&#39;</span><span class="p">][:]])</span>
            <span class="k">if</span> <span class="n">bounds</span> <span class="ow">and</span> <span class="s1">&#39;tau1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">oute</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">datetime</span><span class="p">(</span><span class="mi">1985</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                        <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tau1&#39;</span><span class="p">][:]</span>
                    <span class="p">])</span>
                <span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">oute</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot understand time for file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datetype</span> <span class="o">==</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">datetype</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.stack">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.stack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">stackdim</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concatenates all variables on stackdim</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : instance or list of PseudoNetCDFFiles</span>
<span class="sd">            files to add to this file along stackdim</span>

<span class="sd">        stackdim : str</span>
<span class="sd">            dimension name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with stacked variables and dimension equal to new length</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">f_</span><span class="o">.</span><span class="n">dimensions</span> <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
        <span class="n">shareddims</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">dimk</span><span class="p">,</span> <span class="n">dim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dimk</span> <span class="o">==</span> <span class="n">stackdim</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">dimlens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="n">dimk</span><span class="p">])</span> <span class="k">for</span> <span class="n">dims</span> <span class="ow">in</span> <span class="n">dimensions</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dimlens</span><span class="p">]):</span>
                <span class="n">shareddims</span><span class="p">[</span><span class="n">dimk</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="n">differentdims</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">dims</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
            <span class="n">shareddims</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">for</span> <span class="n">dims</span> <span class="ow">in</span> <span class="n">dimensions</span><span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">different</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">stackdim</span><span class="p">])</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="n">stackdim</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">different</span> <span class="ow">in</span> <span class="n">differentdims</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">dimkey</span> <span class="ow">in</span> <span class="n">shareddims</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dimkey</span><span class="p">]</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dimkey</span><span class="p">)</span>
        <span class="n">newdl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="n">stackdim</span><span class="p">])</span> <span class="k">for</span> <span class="n">dims</span> <span class="ow">in</span> <span class="n">dimensions</span><span class="p">])</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">stackdim</span><span class="p">],</span>
                           <span class="n">key</span><span class="o">=</span><span class="n">stackdim</span><span class="p">,</span> <span class="n">dimlen</span><span class="o">=</span><span class="n">newdl</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tmpf</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">varkey</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">tmpf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">stackdim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">varkey</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varkey</span><span class="p">][</span><span class="o">...</span><span class="p">],</span>
                                           <span class="n">var</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
                        <span class="p">):</span>
                            <span class="k">pass</span>
                        <span class="k">elif</span> <span class="n">varkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                            <span class="n">warn</span><span class="p">((</span><span class="s1">&#39;Got duplicate variables for </span><span class="si">%s</span><span class="s1"> without &#39;</span> <span class="o">+</span>
                                  <span class="s1">&#39;stackable dimension; first value retained&#39;</span><span class="p">)</span>
                                 <span class="o">%</span> <span class="n">varkey</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">outvals</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">varkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">axisi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">stackdim</span><span class="p">)</span>
                        <span class="n">outvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">f_</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varkey</span><span class="p">][:]</span> <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axisi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">outvar</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">varkey</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">outvar</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">outvals</span>

        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.subsetVariables">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.subsetVariables">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">subsetVariables</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">varkeys</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keepcoords</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a PseudoNetCDFFile with only varkeys</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varkeys : iterable of strings</span>
<span class="sd">            keys to keep</span>
<span class="sd">        inplace : boolean</span>
<span class="sd">            if true (default false), then remove other variable from</span>
<span class="sd">            this file</span>
<span class="sd">        exclude : boolean</span>
<span class="sd">            if True (default False), then remove just these variables</span>
<span class="sd">        keepcoords : boolean</span>
<span class="sd">            if True (default True), keep coordinate variables</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">varkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">varkeys</span><span class="p">))</span>

        <span class="n">varkeys</span> <span class="o">=</span> <span class="n">varkeys</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">varkeys</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">varkey</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">varkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">varkeys</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varkey</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">varkey</span> <span class="ow">in</span> <span class="n">varkeys</span><span class="p">:</span>
                <span class="n">varo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varkey</span><span class="p">]</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">varo</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">varkey</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.sliceDimensions">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.sliceDimensions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sliceDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newdims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;POINTS&#39;</span><span class="p">,),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">dimslices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a netcdflike object with dimensions sliced</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newdims : iterable of strings</span>
<span class="sd">            names for new dimensions. When more than one iterable applies to a</span>
<span class="sd">            variable slice, fancy indexing removes both dimensions and creates</span>
<span class="sd">            a new one of the iterable lengths</span>
<span class="sd">        **dimslices : dictionary</span>
<span class="sd">            key value pairs where the key is a dimension and the value is a</span>
<span class="sd">            valid slice object (slices, ints or iterables) if iterables are</span>
<span class="sd">            provided, all iterables must be the same size and shape. If the</span>
<span class="sd">            arrays are not 1D, newdims must have ndim names</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with variables and dimensions sliced</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">newdimlens</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">newdimlens</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>

        <span class="n">isarray</span> <span class="o">=</span> <span class="p">{</span><span class="n">dk</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">dv</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">dimslices</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">anyisarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">isarray</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anyisarray</span><span class="p">:</span>
            <span class="n">arraylens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">da</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
                 <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">dimslices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">isarray</span><span class="p">[</span><span class="n">dk</span><span class="p">]])</span>
            <span class="n">arrayshapes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">da</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
                 <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">dimslices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">isarray</span><span class="p">[</span><span class="n">dk</span><span class="p">]])</span>
            <span class="n">arraylen</span> <span class="o">=</span> <span class="n">arraylens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">arrayshape</span> <span class="o">=</span> <span class="n">arrayshapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="p">(</span><span class="n">arraylens</span> <span class="o">==</span> <span class="n">arraylen</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">or</span>
                <span class="ow">not</span> <span class="p">(</span><span class="n">arrayshapes</span> <span class="o">==</span> <span class="n">arrayshape</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;If slicing with arrays, they must all be the same size &#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;and shape&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">isarray</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ia</span><span class="p">:</span>
                    <span class="n">dimslices</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dimslices</span><span class="p">[</span><span class="n">dk</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">dimslices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># if anyisarray and isarray[dk]: continue</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">dimslices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="n">dvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">))</span>
                <span class="n">newdl</span> <span class="o">=</span> <span class="n">dvar</span><span class="p">[</span><span class="n">dimslices</span><span class="p">[</span><span class="n">dk</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
            <span class="n">newdimlens</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="n">newdl</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dl</span> <span class="ow">in</span> <span class="n">newdimlens</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dk</span><span class="p">]</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">dv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">,</span> <span class="n">dimlen</span><span class="o">=</span><span class="n">dl</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">anyisarray</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ni</span><span class="p">,</span> <span class="n">newdim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">newdims</span><span class="p">):</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">newdim</span><span class="p">,</span> <span class="n">arrayshape</span><span class="p">[</span><span class="n">ni</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vark</span><span class="p">,</span> <span class="n">varo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">vark</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">odims</span> <span class="o">=</span> <span class="n">vdims</span> <span class="o">=</span> <span class="n">varo</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="n">sliceo</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dimslices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">vdims</span><span class="p">)</span>
            <span class="n">isdarray</span> <span class="o">=</span> <span class="p">[</span><span class="n">isarray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">vdims</span><span class="p">]</span>
            <span class="n">needsfancy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">isdarray</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">anyisarray</span> <span class="ow">and</span> <span class="n">needsfancy</span><span class="p">:</span>
                <span class="n">concatax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">isdarray</span><span class="p">)</span>
                <span class="n">odims</span> <span class="o">=</span> <span class="p">[</span><span class="n">dk</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">vdims</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">isarray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dk</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">newdim</span> <span class="ow">in</span> <span class="n">newdims</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">odims</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">concatax</span><span class="p">,</span> <span class="n">newdim</span><span class="p">)</span>

            <span class="n">newvaro</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span>
                <span class="n">varo</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vark</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">odims</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">varo</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">newvaro</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">varo</span><span class="p">,</span> <span class="n">pk</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">anyisarray</span> <span class="ow">and</span> <span class="n">needsfancy</span><span class="p">:</span>
                <span class="n">point_arrays</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arraylen</span><span class="p">):</span>
                    <span class="n">sliceoi</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="n">sliceo</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">si</span><span class="p">):</span>
                            <span class="n">sliceoi</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">si</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                            <span class="n">sliceoi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sliceoi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">sliceoi</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sliceoi</span><span class="p">)</span>
                    <span class="n">point_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                        <span class="n">varo</span><span class="p">[</span><span class="n">sliceoi</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">concatax</span><span class="p">))</span>
                <span class="n">newvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">point_arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">concatax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newvals</span> <span class="o">=</span> <span class="n">varo</span><span class="p">[</span><span class="n">sliceo</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">newvaro</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvals</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">newvaro</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">newvaro</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outf</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.removeSingleton">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.removeSingleton">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">removeSingleton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimkey</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a netcdflike object with dimensions sliced</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimkey : string</span>
<span class="sd">            key of dimension to be evaluated for removal; if None, evaluate</span>
<span class="sd">            all. only singleton dimensions will be removed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        outf : PseudoNetCDFFile</span>
<span class="sd">            instance with dimensions removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copywith</span><span class="p">(</span><span class="n">props</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">removed_dims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dimkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dk</span> <span class="o">==</span> <span class="n">dimkey</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ni</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">removed_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dk</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">,</span> <span class="n">dimlen</span><span class="o">=</span><span class="n">ni</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">olddims</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="n">newdims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="p">[</span><span class="n">dk</span> <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span> <span class="k">if</span> <span class="n">dk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">removed_dims</span><span class="p">])</span>
            <span class="n">sdims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">di</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span> <span class="k">for</span> <span class="n">di</span><span class="p">,</span> <span class="n">dk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">olddims</span><span class="p">)</span> <span class="k">if</span> <span class="n">dk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newdims</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">propd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">pk</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">pk</span><span class="p">))</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">()])</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span><span class="p">,</span> <span class="n">newdims</span><span class="p">,</span> <span class="o">**</span><span class="n">propd</span><span class="p">)</span>
            <span class="n">outvals</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">di</span><span class="p">,</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">sdims</span><span class="p">:</span>
                <span class="n">outvals</span> <span class="o">=</span> <span class="n">outvals</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">di</span><span class="p">)</span>

            <span class="n">ov</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">outvals</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">outf</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.pncdump</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncdump</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">StringIO</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">pncdump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<div class="viewcode-block" id="PseudoNetCDFFile.isMine">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.isMine">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">isMine</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if this file or object can be identified</span>
<span class="sd">        for use by this class. Useful to override for</span>
<span class="sd">        classes that can be initialized from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PseudoNetCDFFile</span><span class="p">,</span> <span class="n">mcl</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">PseudoNetCDFDimensions</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_ncattrs</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_operator_exclude_vars</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<div class="viewcode-block" id="PseudoNetCDFFile.open_mfdataset">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.open_mfdataset">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">open_mfdataset</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">paths</span><span class="p">,</span> <span class="n">stackdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
        <span class="n">file1</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">stackdim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">file1</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">dv</span><span class="o">.</span><span class="n">isunlimited</span><span class="p">():</span>
                    <span class="n">stackdim</span> <span class="o">=</span> <span class="n">dk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dk</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">file1</span><span class="o">.</span><span class="n">dimensions</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dk</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;TSTEP&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">):</span>
                        <span class="n">stackdim</span> <span class="o">=</span> <span class="n">dk</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;No dimension is unlimited or time; &#39;</span> <span class="o">+</span>
                        <span class="s1">&#39;must specify stackdim&#39;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">file1</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">stackdim</span><span class="o">=</span><span class="n">stackdim</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.iswritable">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.iswritable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">iswritable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;r+&#39;</span><span class="p">,))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">k</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">k_</span> <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span> <span class="k">if</span> <span class="n">k_</span> <span class="o">!=</span> <span class="n">k</span><span class="p">])</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<div class="viewcode-block" id="PseudoNetCDFFile.setCoords">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.setCoords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a variable as a coordinate variable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : iterable of strings</span>
<span class="sd">            keys for coord variables</span>
<span class="sd">        missing : string</span>
<span class="sd">            action if missing &#39;ignore&#39;, &#39;skip&#39; or &#39;error&#39;</span>
<span class="sd">            ignore - add in case used later</span>
<span class="sd">            skip   - do not add</span>
<span class="sd">            error  - raise an error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Coordinate variables are excluded from math</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
            <span class="n">invalid_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;File does not contain the variables: &#39;</span> <span class="o">+</span>
                               <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Must be ignore, skip or error; received </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>

        <span class="n">new</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span> <span class="o">=</span> <span class="n">new</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.getCoords">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.getCoords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of coordkeys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">])</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.createDimension">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.createDimension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a dimension</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : string</span>
<span class="sd">            name for dimension</span>
<span class="sd">        length : integer</span>
<span class="sd">            maximum length of dimension</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dim : PseudoNetCDFDimensions</span>
<span class="sd">            new dimension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">PseudoNetCDFDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dim</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.copyDimension">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.copyDimension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copyDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimlen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unlimited</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dimlen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dimlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">unlimited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unlimited</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">isunlimited</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netcdf</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">unlimited</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dimlen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dimlen</span><span class="p">)</span>
            <span class="n">ndv</span><span class="o">.</span><span class="n">setunlimited</span><span class="p">(</span><span class="n">unlimited</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ndv</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.copyVariable">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.copyVariable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copyVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">withdata</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy var into self as vark</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var : PseudoNetCDFVariable</span>
<span class="sd">            netCDF4.Variable-like object (must have ncattrs and setncatts)</span>
<span class="sd">        key : string</span>
<span class="sd">            key for variable in self (can be omitted if var has name,</span>
<span class="sd">            standard_name, or long_name)</span>
<span class="sd">        dtype : string or numpy.dtype</span>
<span class="sd">            change the data type to dtype</span>
<span class="sd">        dimensions : iterable of strings</span>
<span class="sd">            change the dimensions to dimensions</span>
<span class="sd">        fill_value : integer or flaot</span>
<span class="sd">            change the fill_value to this values</span>
<span class="sd">        withdata : boolean</span>
<span class="sd">            default True, copies data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        myvar : PseuodNetCDFVairable</span>
<span class="sd">            copy of var in this file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">propk</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">propk</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">propk</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;varkey must be supplied because var has no name, &#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;standard_name or long_name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">withdata</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">var</span><span class="p">[:]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">var</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">dtype</span>

        <span class="k">if</span> <span class="n">dimensions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">dimensions</span>
        <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fill_value&#39;</span><span class="p">,</span> <span class="s1">&#39;missing_value&#39;</span><span class="p">,</span> <span class="s1">&#39;_FillValue&#39;</span><span class="p">):</span>
                <span class="n">fill_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="n">myvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">propk</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">propk</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">propk</span><span class="p">)</span>
        <span class="n">myvar</span><span class="o">.</span><span class="n">setncatts</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">withdata</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">myvar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">myvar</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">myvar</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.createVariable">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.createVariable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a variable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : string</span>
<span class="sd">            name for new variable</span>
<span class="sd">        type : string or numpy dtype</span>
<span class="sd">            code (e.g., &#39;f&#39;, &#39;i&#39;, &#39;d&#39;)</span>
<span class="sd">        dimensions : tuple of strigns</span>
<span class="sd">            dimension keys that can be found in objects&#39; dimensions dictionary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        var : new variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="n">varopt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_varopt</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fill_value</span> <span class="o">=</span> <span class="n">varopt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fill_value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">varopt</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pk</span> <span class="o">!=</span> <span class="s1">&#39;fill_value&#39;</span><span class="p">:</span>
                <span class="n">properties</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="s1">&#39;missing_value _FillValue&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="n">fill_value</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;fill_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_value</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">PseudoNetCDFMaskedVariable</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">PseudoNetCDFVariable</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.close">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.close">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does nothing.  Implemented for continuity with Scientific.IO.NetCDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.dump">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.dump">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.pncdump</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncdump</span>
        <span class="n">pncdump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.save">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides access to pncwrite for self</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        see Help pncwrite</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        see Help pncwrite</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncwrite</span>
        <span class="k">return</span> <span class="n">pncwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.ncattrs">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.ncattrs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ncattrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.getncattr">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.getncattr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ncattrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> Attribute not found&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.setncattr">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.setncattr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFFile.delncattr">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFFile.delncattr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;**&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="p">(</span><span class="n">NetCDFFile</span><span class="p">,</span> <span class="n">PseudoNetCDFFile</span><span class="p">)):</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
            <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39; == &#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncbo</span>
        <span class="k">return</span> <span class="n">pncbo</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="n">ifile1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifile2</span><span class="o">=</span><span class="n">lhs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">coordkeys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_exclude_vars</span><span class="p">)</span>

    <span class="nb">slice</span> <span class="o">=</span> <span class="n">sliceDimensions</span>
    <span class="n">apply</span> <span class="o">=</span> <span class="n">applyAlongDimensions</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subsetVariables</span>
    <span class="n">sync</span> <span class="o">=</span> <span class="n">close</span>
    <span class="n">flush</span> <span class="o">=</span> <span class="n">close</span></div>



<span class="n">_ncvarkwds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;varname&#39;</span><span class="p">,</span> <span class="s1">&#39;datatype&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;zlib&#39;</span><span class="p">,</span> <span class="s1">&#39;complevel&#39;</span><span class="p">,</span> <span class="s1">&#39;shuffle&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fletcher32&#39;</span><span class="p">,</span> <span class="s1">&#39;contiguous&#39;</span><span class="p">,</span> <span class="s1">&#39;chunksizes&#39;</span><span class="p">,</span> <span class="s1">&#39;endian&#39;</span><span class="p">,</span>
    <span class="s1">&#39;least_significant_digit&#39;</span><span class="p">,</span> <span class="s1">&#39;fill_value&#39;</span>
<span class="p">]</span>


<div class="viewcode-block" id="netcdf">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">netcdf</span><span class="p">(</span><span class="n">PseudoNetCDFFile</span><span class="p">,</span> <span class="n">NetCDFFile</span><span class="p">):</span>
<div class="viewcode-block" id="netcdf.createDimension">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.createDimension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>


<div class="viewcode-block" id="netcdf.createVariable">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.createVariable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_varopt</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">kwds</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>
        <span class="n">propkwds</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">_ncvarkwds</span><span class="p">):</span>
            <span class="n">propkwds</span><span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">outval</span> <span class="o">=</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">propkwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outval</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outval</span></div>


<div class="viewcode-block" id="netcdf.setncattr">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.setncattr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="netcdf.getncattr">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.getncattr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="n">getncattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">NetCDFFile</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

<div class="viewcode-block" id="netcdf.setCoords">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.setCoords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">PseudoNetCDFFile</span><span class="o">.</span><span class="n">setCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_operator_exclude_vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">NetCDFFile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_operator_exclude_vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_varopt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCoords</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="netcdf.get_dest">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.get_dest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the path where a new file is created on some action</span>

<span class="sd">        If None, a file is created in memory.</span>
<span class="sd">        Else, a netcdf file is created on disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_destination&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="netcdf.set_dest">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.set_dest">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the path where a new file is created on some action</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        path : path for new file</span>
<span class="sd">        options : options for new file creation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_destination&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span></div>


<div class="viewcode-block" id="netcdf.get_varopt">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.get_varopt">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_varopt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get options</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        options : dictionary of optiosn</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_varopt&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="netcdf.set_varopt">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.set_varopt">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_varopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set options to be used when creating any Variable</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        options : options for new Variable creation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_varopt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span></div>


<div class="viewcode-block" id="netcdf.ncattrs">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.ncattrs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ncattrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="netcdf.from_ncf">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.from_ncf">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_ncf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">infile</span><span class="p">):</span>
        <span class="n">outf</span> <span class="o">=</span> <span class="n">PseudoNetCDFFile</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">ncattrs</span><span class="p">():</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">outf</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dk</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyDimension</span><span class="p">(</span><span class="n">dv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">dk</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">copyVariable</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">vk</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outf</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_newlike</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to return a file of the same class if a</span>
<span class="sd">        PsueoNetCDFFile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dest</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">netcdf</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dest</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outf</span> <span class="o">=</span> <span class="n">PseudoNetCDFFile</span><span class="p">()</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">set_varopt</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_varopt</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">outf</span>

<div class="viewcode-block" id="netcdf.isMine">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.isMine">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">isMine</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if this file or object can be identified</span>
<span class="sd">        for use by this class. Useful to override for</span>
<span class="sd">        classes that can be initialized from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmpf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">tmpf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cdftest</span> <span class="o">=</span> <span class="n">tmpf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">tmpf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">hdftest</span> <span class="o">=</span> <span class="n">tmpf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">tmpf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cdftest</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;CDF&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">hdftest</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;HDF&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="netcdf.close">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.netcdf.close">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NetCDFFile</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="n">registerreader</span><span class="p">(</span><span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">netcdf</span><span class="p">)</span>
<span class="n">registerreader</span><span class="p">(</span><span class="s1">&#39;ncf&#39;</span><span class="p">,</span> <span class="n">netcdf</span><span class="p">)</span>


<div class="viewcode-block" id="PseudoNetCDFVariables">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFVariables">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PseudoNetCDFVariables</span><span class="p">(</span><span class="n">OrderedDefaultDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PseudoNetCDFVariables provides a special implementation</span>
<span class="sd">    of the default dictionary that provides efficient access</span>
<span class="sd">    to variables of a PseudoNetCDFFile.  PseudoNetCDFFiles may</span>
<span class="sd">    have large variables that should only be loaded if accessed.</span>
<span class="sd">    PseudoNetCDFVariables allows a user to specify a function</span>
<span class="sd">    that can create variables on demand.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        func: function</span>
<span class="sd">            must take a key and provides a PseudoNetCDFVariable</span>
<span class="sd">        keys: iterable of strings</span>
<span class="sd">            keys that the dictionary should act as if it has</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PseudoNetCDFVariables</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span> <span class="o">=</span> <span class="n">keys</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the dictionary does not have a key, check if the</span>
<span class="sd">        user has provided that key.  If so, call the user</span>
<span class="sd">        specifie function to create the variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__func</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;missing &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">))</span>

<div class="viewcode-block" id="PseudoNetCDFVariables.addkey">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFVariables.addkey">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addkey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allow the user to extend keys after the object</span>
<span class="sd">        has been created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>


<div class="viewcode-block" id="PseudoNetCDFVariables.keys">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFVariables.keys">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">k</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

<div class="viewcode-block" id="PseudoNetCDFVariables.items">
<a class="viewcode-back" href="../../../api/PseudoNetCDF.core.html#PseudoNetCDF.sci_var.PseudoNetCDFVariables.items">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Barron H. Henderson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>