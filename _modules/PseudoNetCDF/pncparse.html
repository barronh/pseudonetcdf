

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PseudoNetCDF.pncparse &mdash; PseudoNetCDF 3.4.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=149be4c9"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PseudoNetCDF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">PseudoNetCDF Userâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Example Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readers.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core.html">Core Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/PseudoNetCDF.html">PseudoNetCDF package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../issues.html">Get in touch</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PseudoNetCDF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">PseudoNetCDF.pncparse</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for PseudoNetCDF.pncparse</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pncparse&#39;</span><span class="p">,</span> <span class="s1">&#39;getparser&#39;</span><span class="p">,</span> <span class="s1">&#39;PNC&#39;</span><span class="p">,</span> <span class="s1">&#39;pncprep&#39;</span><span class="p">,</span> <span class="s1">&#39;pnc&#39;</span><span class="p">]</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">argparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArgumentParser</span><span class="p">,</span> <span class="n">Action</span><span class="p">,</span> <span class="n">RawDescriptionHelpFormatter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._getreader</span><span class="w"> </span><span class="kn">import</span> <span class="n">getreaderdict</span><span class="p">,</span> <span class="n">pncopen</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._getwriter</span><span class="w"> </span><span class="kn">import</span> <span class="n">getwriterdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.conventions.ioapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_ioapi_from_cf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.conventions.ioapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_cf_from_wrfioapi</span><span class="p">,</span> <span class="n">add_cf_from_ioapi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF</span><span class="w"> </span><span class="kn">import</span> <span class="n">PseudoNetCDFFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PseudoNetCDF.netcdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">NetCDFFile</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="kn">import</span> <span class="n">MFDataset</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">.sci_var</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce_dim</span><span class="p">,</span> <span class="n">mesh_dim</span><span class="p">,</span> <span class="n">slice_dim</span><span class="p">,</span> <span class="n">getvarpnc</span><span class="p">,</span> <span class="n">extract</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sci_var</span><span class="w"> </span><span class="kn">import</span> <span class="n">mask_vals</span><span class="p">,</span> <span class="n">seqpncbo</span><span class="p">,</span> <span class="n">pncexpr</span><span class="p">,</span> <span class="n">stack_files</span><span class="p">,</span> <span class="n">add_attr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sci_var</span><span class="w"> </span><span class="kn">import</span> <span class="n">convolve_dim</span><span class="p">,</span> <span class="n">manglenames</span><span class="p">,</span> <span class="n">removesingleton</span><span class="p">,</span> <span class="n">merge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sci_var</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_from_file</span><span class="p">,</span> <span class="n">pncrename</span><span class="p">,</span> <span class="n">WrapPNC</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">argparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">SUPPRESS</span>


<span class="n">conv2conv</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">conv2conv</span><span class="p">[(</span><span class="s1">&#39;ioapi&#39;</span><span class="p">,</span> <span class="s1">&#39;cf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">add_cf_from_ioapi</span>
<span class="n">conv2conv</span><span class="p">[(</span><span class="s1">&#39;wrfioapi&#39;</span><span class="p">,</span> <span class="s1">&#39;cf&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">add_cf_from_wrfioapi</span>
<span class="n">conv2conv</span><span class="p">[(</span><span class="s1">&#39;cf&#39;</span><span class="p">,</span> <span class="s1">&#39;ioapi&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">add_ioapi_from_cf</span>

<span class="n">allreaders</span> <span class="o">=</span> <span class="n">getreaderdict</span><span class="p">()</span>
<span class="n">allwriters</span> <span class="o">=</span> <span class="n">getwriterdict</span><span class="p">()</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">allreaders</span><span class="p">)</span>
<span class="n">_readernames</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="k">else</span> <span class="mi">9999</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">getreaderdict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">_readernames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">_readernames</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_readernames</span><span class="p">]</span>
<span class="n">_writernames</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">getwriterdict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">_writernames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">_writernames</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_writernames</span><span class="p">]</span>
<span class="n">_coordkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;time time_bounds TFLAG ETFLAG latitude latitude_bounds &quot;</span> <span class="o">+</span>
              <span class="s2">&quot;longitude longitude_bounds lat lat_bnds lon lon_bnds &quot;</span> <span class="o">+</span>
              <span class="s2">&quot;etam_pressure etai_pressure layer_bounds layer47 layer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PNCArgumentParser</span><span class="p">(</span><span class="n">ArgumentParser</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_sys</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">_sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_HelpAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_HelpAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_HelpListFormats</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_HelpListFormats</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The formats listed below are available &#39;</span> <span class="o">+</span>
              <span class="s1">&#39;for the following options&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-f FORMAT or --format FORMAT or --help-format FORMAT&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;where FORMAT is one of the options below&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_readernames</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**Some readers are listed twice (e.g., without dotted form)&#39;</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_HelpFormat</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_HelpFormat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">file_format</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All formats require a &quot;path&quot;. Some formats also &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;take extra arguments. All arguments other than &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the input path must be specified using keyword&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;arguments.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">helpformat</span> <span class="o">=</span> <span class="n">allreaders</span><span class="p">[</span><span class="n">file_format</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Example:&#39;</span><span class="p">)</span>
            <span class="n">idef</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">helpformat</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">idef</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">idef</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">defs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;VAL&gt;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">idef</span><span class="o">.</span><span class="n">defaults</span><span class="p">))</span> <span class="o">*</span> \
                    <span class="p">[</span><span class="s1">&#39;&lt;VAL&gt;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">idef</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
            <span class="n">longform</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;pncdump -f &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">file_format</span><span class="p">]</span> <span class="o">+</span>
                         <span class="p">[</span><span class="n">karg</span> <span class="o">+</span> <span class="s2">&quot;=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">kdef</span>
                          <span class="k">for</span> <span class="n">karg</span><span class="p">,</span> <span class="n">kdef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">defs</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39; path&#39;</span><span class="p">)</span>
            <span class="n">shortform</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;pncdump -f &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">file_format</span><span class="p">]</span> <span class="o">+</span>
                         <span class="p">[</span><span class="n">karg</span> <span class="o">+</span> <span class="s2">&quot;=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">kdef</span>
                          <span class="k">for</span> <span class="n">karg</span><span class="p">,</span> <span class="n">kdef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">defs</span><span class="p">)</span>
                          <span class="k">if</span> <span class="n">kdef</span> <span class="o">==</span> <span class="s1">&#39;&lt;VAL&gt;&#39;</span><span class="p">])</span> <span class="o">+</span>
                <span class="s1">&#39; path&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">shortform</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">longform</span> <span class="o">!=</span> <span class="n">shortform</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Extended example with keywords:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">longform</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Any keyword with a non &quot;&lt;VAL&gt;&quot; default &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;can be omitted.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** Short help not available for &#39;</span> <span class="o">+</span> <span class="n">file_format</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="o">==</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Hit Y/y to see detailed help</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">help</span><span class="p">(</span><span class="n">helpformat</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AggCommaString</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>


<span class="n">_plotcmds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="s1">&#39;plot2d&#39;</span><span class="p">,</span> <span class="s1">&#39;plotts&#39;</span><span class="p">,</span> <span class="s1">&#39;plotprofile&#39;</span><span class="p">,</span> <span class="s1">&#39;plotscatter&#39;</span><span class="p">]</span>
<span class="n">_allcmds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gen&#39;</span><span class="p">,</span> <span class="s1">&#39;dump&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_plotcmds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_basic_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;ifiles&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;path to a file formatted as type -f&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provides verbosity with pncgen&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--help&quot;</span><span class="p">,</span>
             <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">_HelpAction</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Displays help&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">padd</span><span class="p">(</span><span class="s1">&#39;--pnc&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set of pseudonetcdf commands to be process separately&#39;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;netcdf&#39;</span><span class="p">,</span>
         <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;{see --list-formats for choices}&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;File format (default netcdf), can be one of the choices &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;listed, or an expression that evaluates to a reader. &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;Keyword arguments are passed via ,kwd=value.&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--list-formats&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="n">_HelpListFormats</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show format options for -f&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--help-format&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;helpformat&#39;</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="n">_HelpFormat</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show help for file format (must be one of the options for -f)&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--sep&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;separator&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Used to separate groups of arguments for parsing (e.g., &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;pncgen -- [options1] file(s)1 [--sep [options2] file(s)2 &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;[... [--sep [optionsN] file(s)N]] &quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--inherit&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;inherit&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Allow subparsed sections (separated with -- and --sep) to &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;inherit from global options (-f, --format is always &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;inherited).&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--diskless&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;diskless&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Load file into memory; useful for subsequent processing&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--mangle&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mangle&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove non-standard ascii from names&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--rename&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;rename&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Provide pairs of strings to be substituted &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;--rename=type,oldkey,newkey (type: v = variable; d = &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;dimension;)&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--remove-singleton&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;removesingleton&quot;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove singleton (length 1) dimensions&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--coordkeys&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;coordkeys&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="n">AggCommaString</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_coordkeys</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;key1,key2&quot;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Variables to be ignored in pncbo.&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--variables&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="n">AggCommaString</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;varname1[,varname2[,...,varnameN]&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Variable names or regular expressions (using match) &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;separated by &#39;,&#39;. If a group(s) has been specified, only &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;variables in that (those) group(s) will be selected.&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="s2">&quot;--attribute&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;att_nm,var_nm,mode,att_typ,att_val&quot;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Variables have attributes that can be added following nco &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;syntax (--attribute att_nm,var_nm,mode,att_typ,att_val); &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;mode = a,c,d,m,o and att_typ = f,d,l,s,c,b; att_typ is any &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;valid numpy type.&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;--mask&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;masks&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Masks to apply (e.g., greater,0 or less,0 or values,0, or &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;where,(time[:]</span><span class="si">%%</span><span class="s2">24&lt;12)[:,None].repeat(10,1))&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--from-convention&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;fromconv&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;From convention currently only support ioapi&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--to-convention&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;toconv&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;To convention currently only supports cf&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--stack&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Concatentate (stack) files on the dimension.&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--merge&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;merge&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Combine variables into one file&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--slice&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;slice&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;dim,start[,stop[,step]]&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Variables have dimensions (time, layer, lat, lon), which &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;can be subset using dim,start,stop,stride (e.g., &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;--slice=layer,0,47,5 would sample every fifth layer &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;starting at 0)&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--reduce&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;reduce&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;dim,function[,weight]&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Variable dimensions can be reduced using dim,function,&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;weight syntax (e.g., --reduce=layer,mean,weight). &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;Weighting is not fully functional.&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--mesh&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mesh&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;dim,weight,function&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Variable dimensions can be meshed using dim,function,&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;weight syntax (e.g., --mesh=time,0.5,mean).&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--convolve&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;convolve&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;dim,mode,wgt1,wgt2,...wgtN&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Variable dimension is reduced by convolve function &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;(dim,mode,wgt1,wgt2,...wgtN)&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--extract&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;extract&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;lon/lat coordinates to extract lon1,lat1/lon2,lat2/lon3,&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;lat3/.../lonN,latN&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--extract-file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;extractfile&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;pncparse options for file&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--extractmethod&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;extractmethod&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s1">&#39;nn&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Method for extraction&quot;</span><span class="p">,</span>
         <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ll2ij&#39;</span><span class="p">,</span> <span class="s1">&#39;nn&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="s1">&#39;quintic&#39;</span><span class="p">,</span> <span class="s1">&#39;KDTree&#39;</span><span class="p">])</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--op-typ&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;operators&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Operator for binary file operations. Binary file operations &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;use the first two files, then the result and the next file, &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;etc. Use &quot;</span> <span class="o">+</span>
               <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;is not&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;**&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">])))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--expr&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;expressions&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generic expressions to execute in the context of the file.&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--exprscript&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;expressionscripts&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generic expressions to execute in the context of the file.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_2d_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--swapaxes&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Swap x-y axes&#39;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_eval_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.pnceval</span><span class="w"> </span><span class="kn">import</span> <span class="n">__all__</span> <span class="k">as</span> <span class="n">evalfuncs</span>
    <span class="n">add_interactive_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">padd</span><span class="p">(</span><span class="s1">&#39;--funcs&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">evalfuncs</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Functions to evaluate split by , (default: </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
               <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">evalfuncs</span><span class="p">)))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_map_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--iter&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;iter&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Create plots for each element of specified dimension &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;(e.g., --iter=time).&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--resolution&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;resolution&quot;</span><span class="p">,</span>
         <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Use coarse (c), intermediate (i), or high (h) &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;resolution for maps.&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--no-coastlines&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;coastlines&quot;</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable coastlines by setting equal to False&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--no-countries&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;countries&quot;</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable countries by setting equal to False&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--states&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;states&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable states by setting equal to True&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--counties&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;counties&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable counties by setting equal to True&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--shapefile&quot;</span><span class="p">,</span> <span class="s2">&quot;--shapefiles&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;shapefiles&quot;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Enable custom shapefiles (must be lon, lat). Keyword &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;arguments for display can be added with commas (see -f &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;for syntax).&quot;</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_dump_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-H&quot;</span><span class="p">,</span> <span class="s2">&quot;--header&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--timestring&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;timestring&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--full-indices&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;full_indices&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;[c|f]&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Provide indices in CDL using either C or Fortran style &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;indexes. C style is 0-based and ordered from slowest &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;iterating dimension to fastest. Fortran style is 1-based &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;and ordered from fastest to slowest iterating dimension&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="s2">&quot;--length&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;line_length&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;LEN&quot;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CDL line length (pncdump only)&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--float-precision&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;float_precision&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FDIG&quot;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;single precision digitis (default 8; pncdump only)&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--double-precision&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;double_precision&quot;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PDIG&quot;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;pdig double precision digits (default 16; pncdump only)&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--dump-name&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cdlname&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name for display in ncdump&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_output_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;-O&quot;</span><span class="p">,</span> <span class="s2">&quot;--clobber&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;clobber&quot;</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Overwrite existing file if necessary.&quot;</span><span class="p">)</span>

    <span class="n">ncex</span> <span class="o">=</span> <span class="s2">&quot;NETCDF3_CLASSIC, NETCDF4_CLASSIC, NETCDF4&quot;</span>
    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--out-format&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;outformat&quot;</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s2">&quot;NETCDF4_CLASSIC&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;File output format (e.g., &quot;</span> <span class="o">+</span> <span class="n">ncex</span> <span class="o">+</span> <span class="s2">&quot;;pncgen only)&quot;</span><span class="p">,</span>
         <span class="n">choices</span><span class="o">=</span><span class="n">ncex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">_writernames</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--mode&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
         <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;w a r+ ws as r+s&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;File mode for writing (w, a or r+ or with unbuffered &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;writes ws, as, or r+s; pncgen only).&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s1">&#39;outpath&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s1">&#39;path to a output file formatted as --out-format&#39;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_interactive_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--interactive&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;interactive&quot;</span><span class="p">,</span>
                            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use interactive mode&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_plot_options</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>
    <span class="n">add_interactive_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--matplotlibrc&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;matplotlibrc&quot;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">),</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="s1">&#39;rc options for matplotlib&#39;</span><span class="p">)</span>
    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--figure-keywords&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;figure_keywords&#39;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;dict(&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
         <span class="n">help</span><span class="o">=</span><span class="s1">&#39;options for figure&#39;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--axes-keywords&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;axes_keywords&#39;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;dict(&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">),</span>
         <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;options for axes&#39;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--plot-commands&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;plotcommands&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Plotting functions to call for all variables expressions &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;to execute in the context of the file. The figure object &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;will always be &#39;fig&#39;.&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--figformat&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;figformat&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Any format supported by matplotlib&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--norm&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;normalize&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Typical examples Normalize(), LogNorm(), BoundaryNorm([0, &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;10, 20, 30, 40], ncolors = 256)&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--colorbar-formatter&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;colorbarformatter&quot;</span><span class="p">,</span>
         <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Typical examples LogFormatter(labelOnlyBase = False), &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;ScalarFormatter(), &#39;</span><span class="si">%%</span><span class="s2">3g&#39;&quot;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--overlay&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;overlay&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable overlay by setting equal to True&quot;</span><span class="p">)</span>

    <span class="n">padd</span><span class="p">(</span><span class="s1">&#39;--no-squeeze&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;squeeze&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span>
         <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Squeeze automatically removes singleton dimensions; &#39;</span> <span class="o">+</span>
               <span class="s1">&#39;disabling requires user to remove singleton dimensions &#39;</span> <span class="o">+</span>
               <span class="s1">&#39;with --remove-singleton option&#39;</span><span class="p">))</span>

    <span class="n">padd</span><span class="p">(</span><span class="s2">&quot;--figroot&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path for base of figure (suffixed by action)&#39;</span><span class="p">)</span>


<span class="n">_pncepilog</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Detailed Steps</span>
<span class="s2">--------------</span>

<span class="s2">PseudoNetCDF has many operations and the order often matters. The order is</span>
<span class="s2">consistent with the order of options in the formatted help. The default order</span>
<span class="s2">is summarized as:</span>

<span class="s2">1. Open with specified reader (-f)</span>
<span class="s2">2. Select subset of variables (-v)</span>
<span class="s2">2. Add attributes (-a)</span>
<span class="s2">4. Apply masks (--mask)</span>
<span class="s2">5. Add conventions to support later operations (--to-conv, --from-conv)</span>
<span class="s2">6. Combine files via stacking on dimensions (--stack)</span>
<span class="s2">7. Slice dimensions (-s --slice)</span>
<span class="s2">8. Reduce dimensions (-r --reduce)</span>
<span class="s2">9. Convolve dimensions (-c)</span>
<span class="s2">10. Extract specific coordinates (--extract)</span>
<span class="s2">11. Remove singleton dimensions (--remove-singleton)</span>
<span class="s2">12. Apply expressions (--expr then --exprscripts)</span>
<span class="s2">13. Apply binary operators (--op_typ)</span>

<span class="s2">To impose your own order, use standard options (global options) and then</span>
<span class="s2">use -- to force positional interpretation of remaining options. In remaining</span>
<span class="s2">options, use --sep to separate groups of files and options to be evaluated</span>
<span class="s2">before any global operations.&quot;&quot;&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">getparser2</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">rdesc</span> <span class="o">=</span> <span class="n">RawDescriptionHelpFormatter</span>
    <span class="n">parent_parser</span> <span class="o">=</span> <span class="n">PNCArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;PseudoNetCDF&quot;</span><span class="p">,</span>
                                      <span class="n">formatter_class</span><span class="o">=</span><span class="n">rdesc</span><span class="p">,</span>
                                      <span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">prog</span><span class="o">=</span><span class="s1">&#39;PNC&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">actions</span><span class="p">:</span>
        <span class="n">add_action_commands</span><span class="p">(</span>
            <span class="n">parent_parser</span><span class="p">,</span> <span class="n">withbasic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">add_basic_options</span><span class="p">(</span><span class="n">parent_parser</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parent_parser</span>


<div class="viewcode-block" id="getparser">
<a class="viewcode-back" href="../../api/PseudoNetCDF.html#PseudoNetCDF.pncparse.getparser">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getparser</span><span class="p">(</span><span class="n">has_ofile</span><span class="p">,</span> <span class="n">plot_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">map_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;getparser produces a parser for PseudoNetCDF</span>

<span class="sd">Parameters</span>
<span class="sd">----------</span>
<span class="sd">has_ofile : boolean</span>
<span class="sd">            Requires the outpath option and processes existence check</span>
<span class="sd">plot_options : boolean, optional</span>
<span class="sd">               Adds options for plotting including matplotlibrc, spatial</span>
<span class="sd">               overlays, and normalization options, default is False</span>
<span class="sd">interactive : boolean, optional</span>
<span class="sd">              Adds for interactive option, default is False</span>

<span class="sd">Returns</span>
<span class="sd">-------</span>
<span class="sd">parser : ArgumentParser with options that are processable with pncparse</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">PNCArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;PseudoNetCDF Argument Parsing</span>


<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">epilog</span> <span class="o">=</span> <span class="n">_pncepilog</span>
    <span class="n">add_basic_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">add_interactive_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">actions</span><span class="p">:</span>
        <span class="n">add_action_commands</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Only has output file if pncgen is called.</span>
        <span class="k">if</span> <span class="n">has_ofile</span><span class="p">:</span>
            <span class="n">add_output_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_dump_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_options</span><span class="p">:</span>
            <span class="n">add_plot_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">map_options</span><span class="p">:</span>
            <span class="n">add_map_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span></div>



<div class="viewcode-block" id="pncparse">
<a class="viewcode-back" href="../../api/PseudoNetCDF.html#PseudoNetCDF.pncparse.pncparse">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pncparse</span><span class="p">(</span><span class="n">has_ofile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">map_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ifiles</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Parameters</span>
<span class="sd">----------</span>
<span class="sd">has_ofile : boolean, optional</span>
<span class="sd">            Requires the outpath option and processes existence check</span>
<span class="sd">            default is False</span>
<span class="sd">plot_options : boolean, optional</span>
<span class="sd">               Processes matplotlib options before loading matplotlib</span>
<span class="sd">               (preprocessing important for backend), default is False.</span>
<span class="sd">interactive : boolean, optional</span>
<span class="sd">              Only relevant if parser is not provided (see getparser),</span>
<span class="sd">              default is False.</span>
<span class="sd">args : list or string, optional</span>
<span class="sd">       args are usually taken from the command-line, but can be provided</span>
<span class="sd">       in a function call, default is None.</span>
<span class="sd">parser : AgumentParser object, optional</span>
<span class="sd">         pncparser parser, default getparser(has_ofile,</span>
<span class="sd">                                             plot_options = plot_options,</span>
<span class="sd">                                             interactive = interactive)</span>

<span class="sd">Returns</span>
<span class="sd">-------</span>
<span class="sd">(ifiles, args)</span>

<span class="sd">ifiles : list of PseudoNetCDFFiles</span>
<span class="sd">args : args as parsed</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inputargs</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">getparser</span><span class="p">(</span><span class="n">has_ofile</span><span class="p">,</span> <span class="n">plot_options</span><span class="o">=</span><span class="n">plot_options</span><span class="p">,</span>
                           <span class="n">map_options</span><span class="o">=</span><span class="n">map_options</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">)</span>
    <span class="n">subparser</span> <span class="o">=</span> <span class="n">getparser</span><span class="p">(</span>
        <span class="n">has_ofile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_options</span><span class="o">=</span><span class="n">plot_options</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">args</span>

    <span class="n">args</span><span class="o">.</span><span class="n">inputargs</span> <span class="o">=</span> <span class="n">inputargs</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
    <span class="n">inpaths</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;ifiles&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">inpnc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;pnc&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">inopts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inpaths</span> <span class="o">+</span> <span class="n">inpnc</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">inopts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*ifile or pnc are required&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">args</span>

    <span class="n">subargs</span> <span class="o">=</span> <span class="n">split_positionals</span><span class="p">(</span><span class="n">subparser</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">ifiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">ifile</span> <span class="k">for</span> <span class="n">ifile</span> <span class="ow">in</span> <span class="n">ifiles</span><span class="p">]</span>
    <span class="n">ipaths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unknown&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifiles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">subarg</span> <span class="ow">in</span> <span class="n">subargs</span><span class="p">:</span>
        <span class="n">ipaths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">subarg</span><span class="o">.</span><span class="n">ifiles</span><span class="p">)</span>
        <span class="n">ifiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pncprep</span><span class="p">(</span><span class="n">subarg</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># ifile is set to results from parsing</span>
    <span class="c1"># this includes the standard ifile</span>
    <span class="n">args</span><span class="o">.</span><span class="n">ifiles</span> <span class="o">=</span> <span class="n">ifiles</span>
    <span class="n">args</span><span class="o">.</span><span class="n">ipath</span> <span class="o">=</span> <span class="n">ipaths</span>
    <span class="c1"># if args.stack is not None:</span>
    <span class="c1">#    pass</span>
    <span class="c1"># elif (len(args.ifiles) == 0 or</span>
    <span class="c1">#       (len(args.ifiles) - len(args.operators) - has_ofile) &gt; 1):</span>
    <span class="c1">#    print(&#39;Too many arguments&#39;, len(args.ifiles),</span>
    <span class="c1">#          len(args.operators), has_ofile)</span>
    <span class="c1">#    parser.print_help()</span>
    <span class="c1">#    return</span>
    <span class="k">if</span> <span class="n">has_ofile</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;outpath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">clobber</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">outpath</span><span class="p">):</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;Output path (</span><span class="si">%s</span><span class="s1">) exists; enable &#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;clobber (--clobber or -O) to &#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39;overwrite.&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">outpath</span><span class="p">,)))</span>

    <span class="k">if</span> <span class="n">plot_options</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;matplotlibrc&#39;</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">rcParams</span>
        <span class="k">for</span> <span class="n">rcassigns</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">matplotlibrc</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rcassign</span> <span class="ow">in</span> <span class="n">rcassigns</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">rcassign</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">rcParams</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">pncprep</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">add_action_commands</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">withbasic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span>
                                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Adding commands for subparsing&#39;</span><span class="p">)</span>
    <span class="n">dumpparser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;dump&#39;</span><span class="p">,</span>
                                       <span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Output Common Data &#39;</span> <span class="o">+</span>
                                                    <span class="s1">&#39;Language (like from &#39;</span> <span class="o">+</span>
                                                    <span class="s1">&#39;ncdump)&#39;</span><span class="p">),</span>
                                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;sub-command help&#39;</span><span class="p">,</span>
                                       <span class="n">add_help</span><span class="o">=</span><span class="n">add_help</span><span class="p">)</span>
    <span class="n">add_dump_options</span><span class="p">(</span><span class="n">dumpparser</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">withbasic</span><span class="p">:</span>
        <span class="n">add_basic_options</span><span class="p">(</span><span class="n">dumpparser</span><span class="p">)</span>

    <span class="n">genparser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;gen&#39;</span><span class="p">,</span>
                                      <span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Like ncgen with more &#39;</span> <span class="o">+</span>
                                                   <span class="s1">&#39;format support&#39;</span><span class="p">),</span>
                                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;sub-command help&#39;</span><span class="p">,</span>
                                      <span class="n">add_help</span><span class="o">=</span><span class="n">add_help</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">withbasic</span><span class="p">:</span>
        <span class="n">add_basic_options</span><span class="p">(</span><span class="n">genparser</span><span class="p">)</span>
    <span class="n">add_output_options</span><span class="p">(</span><span class="n">genparser</span><span class="p">)</span>

    <span class="n">evalparser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;eval&#39;</span><span class="p">,</span>
                                       <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Evaluation options.&#39;</span><span class="p">,</span>
                                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;sub-command help&#39;</span><span class="p">,</span>
                                       <span class="n">add_help</span><span class="o">=</span><span class="n">add_help</span><span class="p">)</span>
    <span class="n">add_eval_options</span><span class="p">(</span><span class="n">evalparser</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">withbasic</span><span class="p">:</span>
        <span class="n">add_basic_options</span><span class="p">(</span><span class="n">evalparser</span><span class="p">)</span>

    <span class="n">mapparser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span>
                                      <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Make maps quickly&#39;</span><span class="p">,</span>
                                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;sub-command help&#39;</span><span class="p">,</span>
                                      <span class="n">add_help</span><span class="o">=</span><span class="n">add_help</span><span class="p">)</span>
    <span class="n">add_plot_options</span><span class="p">(</span><span class="n">mapparser</span><span class="p">)</span>
    <span class="n">add_map_options</span><span class="p">(</span><span class="n">mapparser</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">withbasic</span><span class="p">:</span>
        <span class="n">add_basic_options</span><span class="p">(</span><span class="n">mapparser</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">plotcmd</span> <span class="ow">in</span> <span class="n">_plotcmds</span><span class="p">:</span>
        <span class="n">plotparser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
            <span class="n">plotcmd</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Plot data&#39;</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="n">add_help</span><span class="p">)</span>
        <span class="n">add_plot_options</span><span class="p">(</span><span class="n">plotparser</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">withbasic</span><span class="p">:</span>
            <span class="n">add_basic_options</span><span class="p">(</span><span class="n">plotparser</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotcmd</span> <span class="o">==</span> <span class="s1">&#39;plotprofile&#39;</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">.plotutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_vertprofile_options</span>
            <span class="n">add_vertprofile_options</span><span class="p">(</span><span class="n">plotparser</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">do_actions</span><span class="p">(</span><span class="n">outargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;subcommand&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outargs</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">outargs</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;dump&#39;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.pncdump</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncdump</span>
        <span class="k">for</span> <span class="n">ifile</span> <span class="ow">in</span> <span class="n">outargs</span><span class="o">.</span><span class="n">ifiles</span><span class="p">:</span>
            <span class="n">pncdump</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
                    <span class="n">full_indices</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">full_indices</span><span class="p">,</span>
                    <span class="n">line_length</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">line_length</span><span class="p">,</span>
                    <span class="n">float_precision</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">float_precision</span><span class="p">,</span>
                    <span class="n">double_precision</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">double_precision</span><span class="p">,</span>
                    <span class="n">timestring</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">timestring</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">cdlname</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">outargs</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;gen&#39;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.pncgen</span><span class="w"> </span><span class="kn">import</span> <span class="n">pncgen</span>
        <span class="n">nout</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outargs</span><span class="o">.</span><span class="n">ifiles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nout</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s1">&#39;pncgen can output only 1 file; user requested </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nout</span><span class="p">)</span>
        <span class="n">ifile</span><span class="p">,</span> <span class="o">=</span> <span class="n">outargs</span><span class="o">.</span><span class="n">ifiles</span>
        <span class="n">pncgen</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">outargs</span><span class="o">.</span><span class="n">outpath</span><span class="p">,</span> <span class="n">outmode</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
               <span class="nb">format</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">outformat</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">outargs</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">outargs</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;eval&#39;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.pnceval</span><span class="w"> </span><span class="kn">import</span> <span class="n">pnceval</span>
        <span class="n">nin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outargs</span><span class="o">.</span><span class="n">ifiles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nin</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s1">&#39;pnceval requires 2 files; user requested </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nin</span><span class="p">)</span>
        <span class="n">pnceval</span><span class="p">(</span><span class="n">outargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">outargs</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">outargs</span><span class="p">,</span> <span class="s1">&#39;outpath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outargs</span><span class="o">.</span><span class="n">outpath</span> <span class="o">=</span> <span class="n">outargs</span><span class="o">.</span><span class="n">figroot</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.plotutil.pncmap</span><span class="w"> </span><span class="kn">import</span> <span class="n">makemaps</span>
        <span class="n">makemaps</span><span class="p">(</span><span class="n">outargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">outargs</span><span class="o">.</span><span class="n">subcommand</span> <span class="ow">in</span> <span class="n">_plotcmds</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">outargs</span><span class="p">,</span> <span class="s1">&#39;outpath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outargs</span><span class="o">.</span><span class="n">outpath</span> <span class="o">=</span> <span class="n">outargs</span><span class="o">.</span><span class="n">figroot</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">plotutil</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">plotutil</span><span class="p">,</span> <span class="n">outargs</span><span class="o">.</span><span class="n">subcommand</span><span class="p">)(</span><span class="n">outargs</span><span class="p">)</span>


<div class="viewcode-block" id="PNC">
<a class="viewcode-back" href="../../api/PseudoNetCDF.html#PseudoNetCDF.pncparse.PNC">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">PNC</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Arguments:</span>
<span class="sd">    args - Command Line arguments/options for PseudoNetCDF</span>
<span class="sd">           for full list of potential args PNC(&#39;--help&#39;)</span>
<span class="sd">    ifiles - (optional) pre-loaded input files</span>
<span class="sd">    actions -  (default: False)</span>
<span class="sd">        False: only open files do not make outputs</span>
<span class="sd">        True: enable dump,gen,map,etc output actions</span>
<span class="sd">              for action options see subparsers help</span>
<span class="sd">              e.g., PNC(&#39;dump&#39;, &#39;--help&#39;, actions = True)</span>

<span class="sd">Returns:</span>
<span class="sd">    out - Namespace object with parsed arguments</span>
<span class="sd">          including a list of processed files (out.ifiles)</span>

<span class="sd">Example:</span>
<span class="sd">    # Single File</span>
<span class="sd">    out = PNC(&#39;--format=netcdf&#39;, inpath)</span>
<span class="sd">    infile = out.ifiles[0]</span>
<span class="sd">    O3 = infile.variables[&#39;O3&#39;]</span>

<span class="sd">    # Multiple Files</span>
<span class="sd">    out = PNC(&#39;--format=netcdf&#39;, inpath1, inpath2)</span>
<span class="sd">    infile1, infile2 = out.ifiles</span>
<span class="sd">    O3_1 = infile1.variables[&#39;O3&#39;]</span>
<span class="sd">    O3_2 = infile2.variables[&#39;O3&#39;]</span>

<span class="sd">    # With Actions</span>
<span class="sd">    out = PNC(&#39;dump&#39;, &#39;--variables=O3&#39;, &#39;--format=netcdf&#39;, inpath)</span>
<span class="sd">netcdf icartt/dc3-mrg60-dc8_merge_20120518_R7_thru20120622.nc {</span>
<span class="sd">dimensions:</span>
<span class="sd">        POINTS = 6817 ;</span>

<span class="sd">variables:</span>
<span class="sd">        double O3(TSTEP, LAY, ROW, COL);</span>
<span class="sd">                O3_ESRL:units = &quot;ppbV&quot; ;</span>
<span class="sd">                O3_ESRL:standard_name = &quot;Ozone&quot; ;</span>
<span class="sd">                O3_ESRL:missing_value = -999999 ;</span>
<span class="sd">    ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ifiles</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ifiles&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">_allcmds</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">getparser2</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">)</span>
    <span class="n">nfiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifiles</span><span class="p">)</span>
    <span class="n">ifiles</span><span class="p">,</span> <span class="n">outargs</span> <span class="o">=</span> <span class="n">pncparse</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">ifiles</span><span class="o">=</span><span class="n">ifiles</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nfiles</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ifiles</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nfiles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;PNC can only use files or paths, not both at this time&#39;</span><span class="p">)</span>
    <span class="n">do_actions</span><span class="p">(</span><span class="n">outargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outargs</span></div>



<div class="viewcode-block" id="pnc">
<a class="viewcode-back" href="../../api/PseudoNetCDF.html#PseudoNetCDF.pncparse.pnc">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pnc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Arguments - see PNC</span>
<span class="sd">Returns:</span>
<span class="sd">    file(s) - single file or, if more than 1 file is returned a list of files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ifiles</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ifiles&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">PNC</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ifiles</span><span class="o">=</span><span class="n">ifiles</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span><span class="o">.</span><span class="n">ifiles</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">out</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">split_positionals</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">shlex</span>
    <span class="n">positionals</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ifiles</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span>
        <span class="o">**</span><span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">_get_kwargs</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">inherit</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;format&#39;</span><span class="p">]))</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="p">[</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pnc</span><span class="p">)</span> <span class="k">for</span> <span class="n">pnc</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">pnc</span><span class="p">]</span>
    <span class="n">last_split</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positionals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">positionals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;--sep&#39;</span><span class="p">):</span>
            <span class="n">ins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positionals</span><span class="p">[</span><span class="n">last_split</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">last_split</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">ins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positionals</span><span class="p">[</span><span class="n">last_split</span><span class="p">:])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">,</span> <span class="n">ins</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">outns</span><span class="p">,</span> <span class="n">inargs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="n">ins</span><span class="p">):</span>
            <span class="n">outns</span><span class="o">.</span><span class="n">inputargs</span> <span class="o">=</span> <span class="n">inargs</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">be</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">be</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">args</span>

    <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">outs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">cdlname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">cdlname</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">ifiles</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;cdlname&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">args</span><span class="o">.</span><span class="n">cdlname</span> <span class="o">=</span> <span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cdlname</span>
    <span class="k">return</span> <span class="n">outs</span>


<div class="viewcode-block" id="pncprep">
<a class="viewcode-back" href="../../api/PseudoNetCDF.html#PseudoNetCDF.pncparse.pncprep">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">pncprep</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># nifiles = len(args.ifiles) - has_ofile</span>
    <span class="n">ipaths</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ifiles</span><span class="p">[:]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">getfiles</span><span class="p">(</span><span class="n">ipaths</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">subsetfiles</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">seqpncbo</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">operators</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">coordkeys</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">coordkeys</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">expressions</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pncexpr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">expressionscripts</span><span class="p">:</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pncexpr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
    <span class="n">args</span><span class="o">.</span><span class="n">ifiles</span> <span class="o">=</span> <span class="n">fs</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;cdlname&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cdlname</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ipath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cdlname</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
    <span class="k">return</span> <span class="n">fs</span><span class="p">,</span> <span class="n">args</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">subsetfiles</span><span class="p">(</span><span class="n">ifiles</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ifiles</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">slice</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">slice_dim</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">reduce</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">reduce_dim</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">metakeys</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">coordkeys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">mesh</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">mesh_dim</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">convolve</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">convolve_dim</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">extract</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">extractmethod</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">extractfile</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">extractfiles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">shlex</span>
            <span class="k">for</span> <span class="n">extractfile</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">extractfile</span><span class="p">:</span>
                <span class="n">extractfile</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">pncparse</span><span class="p">(</span>
                    <span class="n">has_ofile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">extractfile</span><span class="p">))</span>
                <span class="n">extractfiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extractfile</span><span class="p">)</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">extract_from_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">extractfiles</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">extractmethod</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">removesingleton</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">removesingleton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">rd</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">getfiles</span><span class="p">(</span><span class="n">ipaths</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ipath</span> <span class="ow">in</span> <span class="n">ipaths</span><span class="p">:</span>
        <span class="n">format_options</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">file_format</span> <span class="o">=</span> <span class="n">format_options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">format_options</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;dict(&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">format_options</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span> <span class="p">(</span><span class="n">PseudoNetCDFFile</span><span class="p">,</span> <span class="n">NetCDFFile</span><span class="p">,</span> <span class="n">MFDataset</span><span class="p">)):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ipath</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Most common usecase; open like pncopen</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">pncopen</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span> <span class="o">**</span><span class="n">format_options</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">allreaders</span> <span class="o">=</span> <span class="n">getreaderdict</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">file_format</span> <span class="ow">in</span> <span class="n">allreaders</span><span class="p">:</span>
                        <span class="c1"># Unknown problem, try reader directly</span>
                        <span class="n">allreaders</span><span class="p">[</span><span class="n">file_format</span><span class="p">](</span><span class="n">ipath</span><span class="p">,</span> <span class="o">**</span><span class="n">format_options</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Maybe the format is an expression?</span>
                        <span class="n">allreaders</span><span class="p">[</span><span class="n">file_format</span><span class="p">](</span><span class="n">ipath</span><span class="p">,</span> <span class="o">**</span><span class="n">format_options</span><span class="p">)</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">file_format</span><span class="p">)(</span><span class="n">ipath</span><span class="p">,</span> <span class="o">**</span><span class="n">format_options</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">etmp</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Unable to open path with </span><span class="si">%s</span><span class="s1">(path, **</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n\t</span><span class="s1">&#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;path=&quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n\t</span><span class="s1">error=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="n">oute</span> <span class="o">=</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">etmp</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_format</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">format_options</span><span class="p">),</span>
                                           <span class="n">ipath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                    <span class="k">raise</span> <span class="n">oute</span>  <span class="c1"># from e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;File is type </span><span class="si">%s</span><span class="s1">, which is unknown&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">ipath</span><span class="p">))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">ipath</span>

        <span class="n">history</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;history&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;HISTORY&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">history</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">inputargs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span>
        <span class="n">laddconv</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">fromconv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">toconv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># Need to add backward compatibility</span>
        <span class="c1"># lslice = len(args.slice + args.reduce) &gt; 0</span>
        <span class="c1"># lexpr = len(args.expressions) &gt; 0</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">getvarpnc</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span> <span class="n">coordkeys</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">coordkeys</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">diskless</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">getvarpnc</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
            <span class="n">add_attr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">masks</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">mask_vals</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">metakeys</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">coordkeys</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">laddconv</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">diskless</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">WrapPNC</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conv2conv</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">fromconv</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">toconv</span><span class="p">](</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">coordkeys</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">coordkeys</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot add </span><span class="si">%s</span><span class="s1"> from </span><span class="si">%s</span><span class="s1">; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">toconv</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">fromconv</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;history&#39;</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">mangle</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">manglenames</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rename</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">rename</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">pncrename</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">rename</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">stack_files</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span> <span class="n">coordkeys</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">coordkeys</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">merge</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">merge</span><span class="p">(</span><span class="n">fs</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">fs</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Barron H. Henderson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>